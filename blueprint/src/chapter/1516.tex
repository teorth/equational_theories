\chapter{Equation 1516}\label{1516-chapter}

In this chapter we study magmas that obey equation 1516,
\begin{equation}\label{1516}
  x = (y \op y) \op (x \op (x \op y))
\end{equation}
for all $x,y$.  Using the squaring operator $Sy := y \op y$ and the left and right multiplication operators $L_y x := y \op x$ and $R_y x = x \op y$, this law can be written as
$$ L_{Sy} L_x^2 y = x.$$

We begin by studying a greedily constructed translation invariant model
\begin{equation}\label{xy-1516}
   x \op y = x+f(y-x)
\end{equation}
on the carrier $\Z$ with some function $f:\Z \to \Z$ with $f(0)=0$.  This ensures that $Sx = x$.  If $y = x+h$, then $L_x y = x + f(h)$, $L_x^2 y = x + f^2(h)$, and $L_y L_x^2 y = y + f(f^2(h)-h)$, so the law \Cref{1516} simplifies to
\begin{equation}\label{1516-f}
   f(f^2(h)-h) = -h.
\end{equation}
Thus, if we let $E = \{ (h, f(h))\}$ be the graph of $f$, then we have the following property: if $(a,b), (b,c) \in E$, then $(c-a,-a) \in E$.  This helps motivate the following definition.

\begin{definition}[1516 seed]\label{1516-seed}  A \emph{1516 seed} is a finite collection $E$ of pairs $(a,b)$ with $a,b \in \Z$ obeying the following axioms:
  \begin{itemize}
  \item Axiom 1: $(0,0) \in E$.
  \item Axiom 2: If $(a,b) \in E$ and $a \neq 0$, then $b \neq 0, -a$.
  \item Axiom 3: If $(a,b), (a,b') \in E$, then $b=b'$.
  \item Axiom 4: If $(a,b), (b,c) \in E$, then $(c-a,-a) \in E$.
  \item Axiom 5: If $(b,a), (b',a), (-b, d), (-b',d') \in E$ with $b \neq b'$, then $b+d \neq d', b'+d'$.
  \end{itemize}
An \emph{extension} of a 1516 seed $E$ is a 1516 seed $E'$ that contains $E$.
\end{definition}

This definition has an extension property:

\begin{lemma}[1516 extension]\label{1516-ext}  Let $E$ be a 1516 seed, and let $a_0 \in \Z$.  Then there exists an extension $E'$ of $E$ that contains $(a_0,c_0)$ for some $c_0$.
\end{lemma}

\begin{proof}  We may assume that $E$ does not already contain any pair of the form $(a_0,c)$, since we are done otherwise.  By Axiom 1 implies that $a_0 \neq 0$.  Let $b_1,\dots,b_n$ denote all the integers $b_i$ such that $(b_i,a) \in E$, then $n \geq 0$ is finite, and by Axiom 2 all the $b_i$ are non-zero and not equal to $-a$.  Let $c_0$ be a sufficiently large integer to be chosen later.  We then add the pairs $(a_0,c_0)$ and $(c-b_i,-b_i)$ to $E$ for all $i$.  Furthermore, if $i$ is such that $(-b_i,d_i) \in E$ for some (necessarily unique and non-zero) $d_i$, we also add $(d_i+b+i-c_0, b_i-c_0)$ to $E$.  Let $E'$ be the resulting set of pairs. Axioms 4, 5 for $E$ ensure that (for $c_0$ large enough) the addition of these pairs do not cause a violation of Axioms 2 or 3 for $E'$, and of course Axiom 1 for $E'$ will also be retained.  As for Axiom 4, one can check that the only new pairs of pairs $(',b), (b,c)$ that would trigger these axioms either take the form $(b_i,a_0), (a_0,c_0)$ or $(c_0-b_i,-b_i), (-b_i,d_i)$, and in either case we see from construction that Axiom 4 remains in effect for $E'$.  Finally, the new quadruples of pairs $(b,a), (b',a), (-b, d), (-b',d') \in E'$ only arise when either $(-b,d)$, $(-b',d')$ is equal to $(a_0,c_0)$ and the other three pairs in the quadruple were already in $E$, and for $c_0$ large enough we see that Axiom 5 remains valid.
\end{proof}

For technical reasons (which will be helpful later when we expand the magma) we also give a variant that will ensure a useful ``double surjectivity'' property:

\begin{lemma}[1516 extension variant]\label{1516-ext-var}  Let $E$ be a 1516 seed, and let $h \in \Z$ be non-zero.  Then there exists an extension $E'$ of $E$ that contains $(a,a+h)$, $(a',a'+h)$, $(a'',a''+h)$ for some distinct $a,a',a''$.
\end{lemma}

\begin{proof}  If we choose $a$ sufficiently large, and set $a' = 2a$ and $a''=3a$ (say), the claim simply follows by adding $(a,a+h)$, $(a',a'+h)$ and $(a'',a''+h)$ to $E$ and verifying that none of the axioms are violated.
\end{proof}


\begin{corollary}[Base magma]\label{1516-base} There exists a 1516 magma with carrier $\Z$ with the property that $Sa=a$ for all $a$, and such that for any distinct $a,b \in \Z$, the equation $R_a c = b$ has at least three solutions $c$.  Furthermore, for each $a \in \Z$, there exists $b \neq a$ such that $L_a R_a b = b$.
\end{corollary}

Note from \Cref{1516} and the hypothesis $Sa=a$ that $R_a c = a$ if and only if $c=a$.  Thus, the requirement that $a,b$ be distinct is necessary.

\begin{proof}  By \Cref{1516-ext}, \Cref{1516-ext-var} and the greedy algorithm starting with the seed consisting of $(0,0)$, $(-1,2)$, $(3,1)$, we obtain a graph $\{ (a,f(a)): a \in \Z \}$ of a function $f:\Z \to \Z$ with $f(0)=0$, $f(-1)=2$, $f(3)=1$ and the property that if $f(a)=b$ and $f(b)=c$, then $f(c-a)=-a$, and also with the property that for every non-zero $h$ there are distinct $a_h, a'_h, a''_h$ with $f(a_h)=a_h+h$, $f(a'_h) = a'_h+h$, and $f(a''_h) = a''_h+h$.  We then have \Cref{1516-f} holds.  If we then define the magma operation $\op$ by \Cref{xy-1516}, we obtain \Cref{1516}.  Also, from construction we see that $R_d (d - a_h) = R_d (d - a'_h) = R_d (d - a''_h) = d+h$ for any $d,h$, giving the second claim.  Finally, from construction we have $R_a (a+1) = a+1+f(-1) = a+3$, so $L_a R_a (a+1) = a + f(3) = a+1$, giving the final claim.
\end{proof}

Let us denote by $A$ the free group over $\N$. Note that a magma with the same properties as in \Cref{1516-base} but having carrier $A$ can be constructed similarly. We will mean this in the sequel when we refer to \Cref{1516-base}.

Now we construct a more complex 1516 magma, whose carrier $G$ is $A \cup G'$, where
$$G' := \{ (a,c,n) \in A \times A \times \N : a \neq c\}.$$
The first component $A$ will represent the squares, and the second component $G'$ will represent the non-squares; the third coordinate in the elements of $G'$ is a technical label needed to ensure a certain infinite subjectivity property.  The 1516 magma constructed in \Cref{1516-base} will be the restriction of $G$ to $A$; thus $a \op b$ is already defined in $G$ for $a,b \in A$, but the rest of the multiplication table is not currently defined.  By construction, $S$ is already defined and equal to the identity on $A$, and we have the 1516 equation
$$ L_{Sa} L_b L_b a = b$$
for $a,b \in A$, with the left multiplication operators $L_b$ currently only defined as maps from $A$ to $A$.  Among other things, this means that $L_a = L_{Sa}$ is surjective as a map from $A$ to $A$ for any $a \in A$.

We extend the squaring map $S$ to all of $G$ by declaring $S(a,b,n) := a$, thus $S$ maps $G$ to $A$.  To create a 1516 magma structure on all of $G$, we need to extend the left multiplication operators $L_b$, $b \in A$ as maps from $G$ to $G$, and also introduce additional maps $L_x: G \to G$ for $x \in G'$, obeying the following axioms:
\begin{itemize}
\item Axiom A: For any $x \in G'$, $L_x x = Sx$.
\item Axiom B: For any $x \in G'$ and $b \in A$, $L_{Sx} L_b L_b x = b$.
\item Axiom C: For any $x \in G$ and $y \in G'$, $L_{Sx} L_y L_y x = y$.
\end{itemize}

We first address Axiom B, which purely concerns how to extend the $L_b$ operators for $b \in A$, and also impose an additional technical ``infinitely surjective'' requirement that will help us satisfy Axiom C later.

\begin{proposition}[Obtaining Axiom B]\label{axiom-b}  There exists a way to extend $L_b: A \to A$ to $L_b: G \to G$ for all $b \in A$, in such a way that Axiom B holds, and furthermore for each $b \in A$ and $x \in G'$, the set $\{ y \in G': L_b y = x \}$ is infinite. Also, we can ensure that $L_b x \neq x$ for any $b \in \Z$ and $x \in G'$.
\end{proposition}

\begin{proof}  Let $y = (a,c,n)$ be a ``non-square'' in $G'$, thus $a \neq c$ and $Sy = a$.  We first define the operation $L_a$ on $y$ as follows:
\begin{itemize}
  \item If $n \neq 0$, we set $L_a y := (a,c,0)$.
  \item If $n=0$, we set $L_a y = a$.
\end{itemize}
In particular, we obtain the special case $L_{Sy} L_a L_a y = a$ of Axiom B.  We also see that the preimage $\{ z \in G': L_a z = y \}$ is already infinite if $n = 0$, but this has not yet been established in the $n \neq 0$ case.

We still need to define $L_c y$ for other $c \in A$.  We claim that for each $b \in A$ we can find $c_{y,b} \in A$, which are distinct as $b$ varies, such that
$L_a L_{c_{y,b}} b = c_{y,b}$.  For $b=a$, we can write $L_a L_{c_{y,b}} b = L_a R_a c_{y,b}$ and invoke the final property of \Cref{1516-base}.  For $b \neq a$, we apply \Cref{1516-base} to find $c_{y,b} \in A$ distinct from $b, c_{y,a}$ such that $R_a c_{y,b} = b$; note that $c_{y,b}$ is also distinct from $a$ since $R_a a = a \neq b$.  Clearly the $c_{y,b}$ are distinct as $b$ varies.  We now have $L_a L_{c_{y,b}} b = L_{Sa} L_{c_{y,b}} L_{c_{y,b}} a = c_{y,b}$ as desired.

So if we define $L_{c_{y,b}} y := b$ for all $b \in A$, then we have $L_{Sy} L_{c'} L_{c'} y = c'$ whenever $c'$ is of the form $c' = c_{y,b}$ for some $b \in A$.  But we still have $L_{c'} y$ undefined if $c'$ is not of this form or equal to $a$, in particular, $L_c y$ is currently not defined.

Now we greedily fill in the rest of the $L_{c'}$ functions.  Suppose at some stage of this process, we have a non-square element $y = (a,c,n)$ for which $L_{c'} y$ is not yet defined for some $c'$, then $c' \neq a$. We can use the surjectivity of $L_a: A \to A$ to write $c' = L_a b$ for some $b \in A$, then we use the surjectivity of $L_{c'}: A \to A$ to write $b = L_{c'} d$ for some $d \in A$, and we set $L_{c'} y = d$; then we have $L_{Sy} L_{c'} L_{c'} y = c'$.
Observe how $c' \neq d$. In fact, if $c' = d$, then $b = L_{c'} c' = c'$, so $c' = L_a c'$. This can hold if and only if $c' = a = S y$, but that is not the case.

We also note that with our construction so far, that $L_c y \neq c$ whenever $y \in G'$ and $c \in A$ is distinct from $Sy$.  This property will be preserved in the construction below (because all future assignments of $L_c y$ will take values in $G'$ rather than $A$).

Next, suppose we want to write $y$ as $L_{c'} z$ for some $z$ where $L_{c'}$ is not currently defined, in such a way that $L_{Sz} L_{c'} L_{c'} z = c'$.  There are several cases:
\begin{itemize}
\item Case 1: $L_{c'} y = w$ for some $w \in G'$.  By construction, $c_{w,c'}$ is distinct from $c'$ and $L_{c_{w,c'}} w = c'$.  Set $z = (c_{w,c'}, c', n')$ where $n'$ is large enough that $L_{c'} z$ has not yet been assigned.  Then set $L_{c'} z = y$, so that we have $L_{Sz} L_{c'} L_{c'} z = c'$ as required.
\item Case 2: $c' \neq Sy$ and $L_{c'} y = b$ for some $b \in \Z$. By the previous property, $c' \neq b$.  By \Cref{1516-base}, we can find $a'$ such that $R_b a' = c'$ and $a' \neq c'$.  Then set $z = (a', c', n')$ where $n'$ is large enough that $L_{c'} z$ has not yet been assigned.  Then set $L_{c'} z = y$, so that we have $L_{Sz} L_{c'} L_{c'} z = c'$ as required.
\item Case 3: $c' \neq Sy$ and $L_{c'} y$ is currently undefined.  Use the previous procedure to set $L_{c'} y$ equal to some $b \in \Z$, then apply the Case 2 analysis.
\item Case 4: $c' = Sy$.  We can assume $n=0$, since otherwise we are in Case 1 by construction.  But then we do not need to locate any $z$ because, as previously mentioned, the set $\{ z \in G': L_{c'} z = y \}$ is already infinite.
\end{itemize}

Iterating these procedures over a well-ordering of $G' \times \Z \times \N$, we can show that for any finite initial segment in this well-ordering, we can create a partially defined extension of all the $L_b$, such that if $(x,c',m)$ is in this initial segment, then $L_{Sx} L_{c'} L_{c'} x$ is well-defined and equal to $x$,  and $\{ y \in G': L_b y = x \}$ has at least $m$ elements.  Running this iteration over the entire well-ordering, we obtain the claim.
\end{proof}

Finally, we construct the remaining $L_x$.

\begin{proposition}[Obtaining Axioms A, C]\label{axiom-c} One can find maps $L_x: G \to G$ for each ``non-square'' $x \in G'$, such that Axioms A, C hold.
\end{proposition}

\begin{proof}  We can work with a single $x \in G'$.  Our task is to find a function $L_x$ for which
\begin{equation}\label{axioma-again}
   L_x x = Sx
\end{equation}
and
\begin{equation}\label{axiomb-again}
  L_{Sy} L_x L_x y = x
\end{equation}
for all $y \in G$ (note that $L_{Sy}$ is already fully constructed).

Define a \emph{seed} to be an injective partial function $L_x$ defined on finitely many values and obeying \Cref{axioma-again}, as well as \Cref{axiomb-again} whenever $L_x L_x y$ is defined.  If there is a $y \in G$ for which $L_x y$ is currently undefined, then by hypothesis $y$ is equal to $L_x z$ for at most one $z$.  If such a $z$ exists, we set $L_x y$ to be an element of $\{ w: L_{Sz} w = x \}$ that is not already in the domain or range of $L_x$; if no such $z$ exists, we set $L_x y$ to be arbitrary element of $G$ not already in the domain or range.  In either case, we see that the seed property is preserved.  Starting from the seed in which $L_x$ is only defined on $x$ and maps it to $Sx$, we obtain the claim.
\end{proof}

\begin{corollary}\label{1516-no-255}  There exists a 1516 magma that does not obey the 255 equation $$x = ((x \op x) \op x) \op x.$$
\end{corollary}

\begin{proof}
  Let us define the element $x_0 := (*, 0, 0) \in G'$, where $*$ is the empty word (the identity element of $A$), while the second component is the word in $A$ composed of a single letter $0$.
  Since $S x_0 = *$, we know that $* \op x_0 = *$ (see the first part of the proof of \Cref{axiom-b}).
  Therefore, $x_0$ does not obey the 255 equation, as we have
  $$((x_0 \op x_0) \op x_0) \op x_0 = (* \op x_0) \op x_0 = * \op x_0 = * \neq x_0.$$
\end{proof}
