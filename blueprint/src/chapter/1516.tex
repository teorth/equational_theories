\chapter{Equation 1516}\label{1516-chapter}

In this chapter we study magmas that obey equation 1516,
\begin{equation}\label{1516}
  x = (y \op y) \op (x \op (x \op y))
\end{equation}
for all $x,y$.  Using the squaring operator $Sy := y \op y$ and the left and right multiplication operators $L_y x := y \op x$ and $R_y x = x \op y$, this law can be written as
$$ L_{Sy} L_x^2 y = x.$$

We begin by studying a greedily constructed translation invariant model
\begin{equation}\label{xy-1516}
   x \op y = x+f(y-x)
\end{equation}
on the carrier $\Z$ with some function $f:\Z \to \Z$ with $f(0)=0$.  This ensures that $Sx = x$.  If $y = x+h$, then $L_x y = x + f(h)$, $L_x^2 y = x + f^2(h)$, and $L_y L_x^2 y = y + f(f^2(h)-h)$, so the law \Cref{1516} simplifies to
\begin{equation}\label{1516-f}
   f(f^2(h)-h) = -h.
\end{equation}
Thus, if we let $E = \{ (h, f(h))\}$ be the graph of $f$, then we have the following property: if $(a,b), (b,c) \in E$, then $(c-a,-a) \in E$.  This helps motivate the following definition.

\begin{definition}[1516 seed]\label{1516-seed}  A \emph{1516 seed} is a finite collection $E$ of pairs $(a,b)$ with $a,b \in \Z$ obeying the following axioms:
  \begin{itemize}
  \item Axiom 1: $(0,0) \in E$.
  \item Axiom 2: If $(a,b) \in E$ and $a \neq 0$, then $b \neq 0, -a$.
  \item Axiom 3: If $(a,b), (a,b') \in E$, then $b=b'$.
  \item Axiom 4: If $(a,b), (b,c) \in E$, then $(c-a,-a) \in E$.
  \item Axiom 5: If $(b,a), (b',a), (-b, d), (-b',d') \in E$ with $b \neq b'$, then $b+d \neq d', b'+d'$.
  \end{itemize}
An \emph{extension} of a 1516 seed $E$ is a 1516 seed $E'$ that contains $E$.
\end{definition}

This definition has an extension property:

\begin{lemma}[1516 extension]\label{1516-ext}  Let $E$ be a 1516 seed, and let $a_0 \in \Z$.  Then there exists an extension $E'$ of $E$ that contains $(a_0,c_0)$ for some $c_0$.
\end{lemma}

\begin{proof}  We may assume that $E$ does not already contain any pair of the form $(a_0,c)$, since we are done otherwise.  By Axiom 1 implies that $a_0 \neq 0$.  Let $b_1,\dots,b_n$ denote all the integers $b_i$ such that $(b_i,a) \in E$, then $n \geq 0$ is finite, and by Axiom 2 all the $b_i$ are non-zero and not equal to $-a$.  Let $c_0$ be a sufficiently large integer to be chosen later.  We then add the pairs $(a_0,c_0)$ and $(c-b_i,-b_i)$ to $E$ for all $i$.  Furthermore, if $i$ is such that $(-b_i,d_i) \in E$ for some (necessarily unique and non-zero) $d_i$, we also add $(d_i+b+i-c_0, b_i-c_0)$ to $E$.  Let $E'$ be the resulting set of pairs. Axioms 4, 5 for $E$ ensure that (for $c_0$ large enough) the addition of these pairs do not cause a violation of Axioms 2 or 3 for $E'$, and of course Axiom 1 for $E'$ will also be retained.  As for Axiom 4, one can check that the only new pairs of pairs $(',b), (b,c)$ that would trigger these axioms either take the form $(b_i,a_0), (a_0,c_0)$ or $(c_0-b_i,-b_i), (-b_i,d_i)$, and in either case we see from construction that Axiom 4 remains in effect for $E'$.  Finally, the new quadruples of pairs $(b,a), (b',a), (-b, d), (-b',d') \in E'$ only arise when either $(-b,d)$, $(-b',d')$ is equal to $(a_0,c_0)$ and the other three pairs in the quadruple were already in $E$, and for $c_0$ large enough we see that Axiom 5 remains valid.
\end{proof}

For technical reasons (which will be helpful later when we expand the magma) we also give a variant that will ensure a useful ``double surjectivity'' property:

\begin{lemma}[1516 extension variant]\label{1516-ext-var}  Let $E$ be a 1516 seed, and let $h \in \Z$ be non-zero.  Then there exists an extension $E'$ of $E$ that contains $(a,a+h)$, $(a',a'+h)$, $(a'',a''+h)$ for some distinct $a,a',a''$.
\end{lemma}

\begin{proof}  If we choose $a$ sufficiently large, and set $a' = 2a$ and $a''=3a$ (say), the claim simply follows by adding $(a,a+h)$, $(a',a'+h)$ and $(a'',a''+h)$ to $E$ and verifying that none of the axioms are violated.
\end{proof}


\begin{corollary}[Base magma]\label{1516-base} There exists a 1516 magma with carrier $\Z$ with the properties that
  \begin{itemize}
    \item[(i)] $Sa=a$ for all $a$.
    \item[(ii)] For any distinct $a,b \in \Z$, the equation $R_a c = b$ has at least three solutions $c$.
    \item[(iii)] For each $a \in \Z$, there exist at least two $b \neq a$ such that $L_a R_a b = b$.
  \end{itemize}
\end{corollary}

Note from \Cref{1516} and the hypothesis $Sa=a$ that $R_a c = a$ if and only if $c=a$.  Thus the requirement that $a,b$ be distinct in (ii)is necessary.

\begin{proof}  By \Cref{1516-ext}, \Cref{1516-ext-var} and the greedy algorithm starting with the seed consisting of $(0,0)$, $(-1,2)$, $(3,1)$, $(-10,20)$, $(30,10)$, we obtain a graph $\{ (a,f(a)): a \in \Z \}$ of a function $f:\Z \to \Z$ with $f(0)=0$, $f(-1)=2$, $f(3)=1$, $f(-10) = 20$, $f(30)=10$ and the property that if $f(a)=b$ and $f(b)=c$, then $f(c-a)=-a$, and also with the property that for every non-zero $h$ there are distinct $a_h, a'_h, a''_h$ with $f(a_h)=a_h+h$, $f(a'_h) = a'_h+h$, and $f(a''_h) = a''_h+h$.  We then have that \Cref{1516-f} holds.  If we then define the magma operation $\op$ by \Cref{xy-1516}, we obtain \Cref{1516}, and since $f(0)=0$ we have (i).  Also, from construction we see that $R_d (d - a_h) = R_d (d - a'_h) = R_d (d - a''_h) = d+h$ for any $d,h$, giving (ii).  Finally, from construction we have $R_a (a+1) = a+1+f(-1) = a+3$, so $L_a R_a (a+1) = a + f(3) = a+1$, and similarly $R_a (a+10) = a+10$, giving (iii).
\end{proof}

Now we construct a more complex 1516 magma, whose carrier $G$ is $\Z \cup G'$, where
$$G' := \{ (a,c,n) \in \Z \times \Z \times \N : a \neq c\}.$$
The first component $\Z$ will represent the squares, and the second component $G'$ will represent the non-squares.  The most important coordinate of an element $(a,c,n)$ of $G'$ is $a$; the other two components $c,n$ are technical, with $n$ being needed to ensure a certain infinite surjectivity property, and $c$ being such that $L_c (a,c,n)$ remains at one's disposal to select at certain stages of the inductive process.

The 1516 magma constructed in \Cref{1516-base} will be the restriction of $G$ to $\Z$; thus $a \op b$ is already defined in $G$ for $a,b \in \Z$, but the rest of the multiplication table is not currently defined.  By construction, $S$ is already defined and equal to the identity on $\Z$, and we have the 1516 equation
$$ L_{Sa} L_b L_b a = b$$
for $a,b \in \Z$, with the left multiplication operators $L_b$ currently only defined as maps from $\Z$ to $\Z$.  Among other things, this means that $L_a = L_{Sa}$ is surjective as a map from $\Z$ to $\Z$ for any $a \in \Z$.

We extend the squaring map $S$ to all of $G$ by declaring $S(a,c,n) := a$, thus $S$ maps $G$ to $\Z$.  To create a 1516 magma structure on all of $G$, we need to extend the left multiplication operators $L_b$, $b \in \Z$ as maps from $G$ to $G$, and also introduce additional maps $L_x: G \to G$ for $x \in G'$, obeying the following axioms:
\begin{itemize}
\item Axiom A: For any $x \in G'$, $L_x x = Sx$.
\item Axiom B: For any $x \in G'$ and $b \in \Z$, $L_{Sx} L_b L_b x = b$.
\item Axiom C: For any $x \in G$ and $y \in G'$, $L_{Sx} L_y L_y x = y$.
\end{itemize}

We first address Axiom B, which purely concerns how to extend the $L_b$ operators for $b \in \Z$, and also impose an additional technical ``infinitely surjective'' requirement that will help us satisfy Axiom C later.  We first need some preparatory lemmas.  We begin by locating some useful elements $c_{y,b}$ of $\Z$ for all $y \in G'$ and $b \in \Z$.

\begin{lemma}[Useful elements]\label{aux}  One can assign $c_{y,b} \in \Z$ for each $y = (a,c,n) \in G'$ and $b \in \Z$ with the following properties:
\begin{itemize}
\item[(i)] For all $y = (a,c,n) \in G'$ and $b \in \Z$, $c_{y,b} \neq a,b,c$ and $L_a L_{c_{y,b}} b = c_{y,b}$.
\item[(ii)] For all $y \in G'$, the map $b \mapsto c_{y,b}$ is injective.
\end{itemize}
\end{lemma}

\begin{proof}  Let $y = (a,c,n)$.  By \Cref{1516-base}(iii), we can find $c_{y,a} \neq a,c$ such that $L_a R_a c_{y,a} = c_{y,a}$, or equivalently $L_a L_{c_{y,a}} a = c_{y,a}$.  Next, for any $b \neq a$, we can apply \Cref{1516-base}(ii) to find $c_{y,b} \neq b, c_{y,a}$ such that $R_a c_{y,b} = b$; note that as $R_a a = Sa = a \neq b$, this also implies that $c_{y,b} \neq a$, and that the $c_{y,b}$ are distinct as $b$ variables.  We now have $L_a L_{c_{y,b}} b = L_{Sa} L_{c_{y,b}} L_{c_{y,b}} a = c_{y,b}$ for such $b$, giving the claim.
\end{proof}

Let $c_{y,b}$ be as above. Define a \emph{partial solution} to be a partial assignment of $L_{c'} y \in G$ for $c' \in \Z$ and $y \in G$ that obeys the following properties:
\begin{itemize}
\item[(a)] If $y \in \Z$, then $L_{c'} y$ agrees with the operation defined in \Cref{1516-base}.
\item[(b)] If $y = (a,c,0) \in G'$, then $L_a y = a$.
\item[(c)] If $y = (a,c,n) \in G'$ and $n \neq 0$, then $L_a y = (a,c,0)$.
\item[(d)] If $y = (a,c,n) \in G'$ and $b \in \Z$, then $L_{c_{y,b}} y = b$.
\item[(e)] For any $a,c$, $L_c (a,c,n)$ is only defined for finitely many $n$.
\item[(f)] If $y = (a,c,n) \in G'$ and $c' \in \Z$ are such that $L_{c'} y$ is defined, then $L_{c'} L_{c'} y$ and $L_a L_{c'} L_{c'} y$ are defined, with $L_a L_{c'} L_{c'} y$ equal to $c'$.
\item[(g)] If $y = (a,c,n) \in G'$ and $c' \in \Z$ is such that $c' \neq a$, then $L_{c'} y \neq c'$.
\end{itemize}

\begin{lemma}[Existence of partial solution]\label{part-exist}  A partial solution exists.
\end{lemma}

\begin{proof}  We define $L_{c'} y$ for $y = (a,c,n) \in G'$ as follows:
\begin{itemize}
  \item[(i)] If $c' = a$ and $n=0$, then $L_{c'} y := a$.
  \item[(ii)] If $c' = a$ and $n \neq 0$, then $L_{c'} y := (a,c,0)$.
  \item[(iii)] If $c' = c_{y,b}$ for some $b$, then $L_{c'} y := b$.
  \item[(iv)] In all other cases, $L_{c'} y$ is undefined.
\end{itemize}
We of course also define $L_{c'} y$ for $y \in \Z$ using \Cref{1516-base}.

From Lemma \ref{aux} we see that this is a well-defined operation, with $L_c y$ undefined for any $y = (a,c,n) \in G'$.  So properties (a)-(e) and (g) are clear from construction.  Property (e) is also clear from construction in each of the three cases (i), (ii), (iii) (for (i), (ii) we also use the fact that $L_a a = a$).
\end{proof}

We can make $L_{c'} y$ defined in a partial solution:

\begin{lemma}[First extension]\label{first-ext}  Suppose we have a partial solution for which $L_{c'} y$ is currently undefined for some $c' \in \Z$ and $y \in G$.  Then one can extend this partial solution in such a manner that $L_{c'} y$ is now defined.
\end{lemma}

\begin{proof} Write $y = (a,c,n)$. Because $L_a: \Z \to \Z$ and $L_{c'}: \Z \to \Z$ are surjective, we can find $b \in \Z$ such that $L_a L_{c'} b = c'$.  If we had $b=c'$, then $L_a c' = c'$, which from \eqref{1516} (and $Sc' = c'$) implies that $a = c'$, which contradicts the undefined nature of $L_{c'} y$ thanks to properties (b), (c) of a partial solution.  Hence $b \neq c'$.
  We then set $L_{c'} y := b$.  It is then clear that all of the properties (a)-(g) of a partial solution are maintained.
\end{proof}

We can also insert inverses of $L_{c'}$:

\begin{lemma}[Second extension]\label{second-ext}  Suppose we have a partial solution, and let $c' \in \Z$ and $y = (a,c,n) \in G$.  Then, unless one is in the case when $c'=a$ and $n=0$, then one can find $z \in G$ such that $L_{c'} z$ is currently undefined, but for which one can find an extension of the partial solution for which $L_{c'} z$ is now equal to $y$.
\end{lemma}

\begin{proof} Write $y = (a,c,n)$. There are several cases.
  \begin{itemize}
    \item Case 1: $L_{c'} y = w$ for some $w \in G'$.  By Lemma \ref{aux}, $c_{w,c'}$ is distinct from $c'$, and from property (d) of a partial solution, $L_{c_{w,c'}} w = c'$.  By property (e) of a partial solution, we can find $z = (c_{w,c'}, c', n')$ such that $L_{c'} z$ is currently undefined.  Then set $L_{c'} z := y$, so that we have $L_{c_{w,c'}} L_{c'} L_{c'} z = c'$.  One then verifies that all the axioms (a)-(g) of a partial solution are valid in this case.
    \item Case 2: $c' \neq a$ and $L_{c'} y = b$ for some $b \in \Z$. By property (g) of a partial solution, $c' \neq b$.  By \Cref{1516-base}, we can find $a'$ such that $L_{a'} b = R_b a' = c'$ and $a' \neq c'$.  By property (e) of a partial solution, we can find $z = (a', c', n', 0)$ such that $L_{c'} z$ is currently undefined.  Then set $L_{c'} z = y$, so that we have $L_{a'} L_{c'} L_{c'} z = c'$. One then verifies that all the axioms (a)-(g) of a partial solution are valid in this case.
    \item Case 3: $c' \neq a$ and $L_{c'} y$ is currently undefined.  Use Lemma \ref{first-ext} set $L_{c'} y$ equal to some $b \in \Z$, then apply the Case 2 analysis.
    \item Case 4: $c' = a$.  Because we are excluding the case $n=0$, we are now in Case 1 thanks to property (c) of a partial solution.
  \end{itemize}
\end{proof}


Now we can establish Axiom B.

\begin{proposition}[Obtaining Axiom B]\label{axiom-b}  There exists a way to extend $L_b: \Z \to \Z$ to $L_b: G \to G$ for all $b \in \Z$, in such a way that Axiom B holds, and furthermore for each $b \in \Z$ and $x \in G'$, the set $\{ y \in G': L_b y = x \}$ is infinite. Also we can ensure that $L_b x \neq x$ for any $b \in \Z$ and $x \in G'$.
\end{proposition}

\begin{proof}
By iterating \Cref{first-ext} and \Cref{second-ext} in alternation, we can find an increasing chain of partial solutions with the property that for any $y = (a,c,n) \in G'$ and $c' \in \Z$ and any natural number $k$, excluding the case where $c'=a$ and $n=0$, that one can find a partial solution on this chain for which $L_{c'} y$ is defined, and such that $L_{c'} z = y$ for at least $k$ distinct choices of $z \in G'$.  Taking the limit of this chain, we can then find a fully defined operation $L_{c'} y$ for $c' \i \Z$ and $y \in G$ obeying the properties (a)-(d), (f), (g) (but not (e)) of a partial solution, with the property that
$y = (a,c,n) \in G'$ and $c' \in \Z$, excluding the case $c'=a$ and $n=0$, that there are infinitely many $z \in G'$ such that $L_{c'} z = y$.  The excluded case $c'=a, n=0$ is also covered by property (b) of a partial solution.  The claim follows.
\end{proof}

Finally, we construct the remaining $L_x$.

\begin{proposition}[Obtaining Axioms A, C]\label{axiom-c} One can find maps $L_x: G \to G$ for each ``non-square'' $x \in G'$, such that Axioms A, C hold.
\end{proposition}

\begin{proof}  We can work with a single $x \in G'$.  Our task is to find a function $L_x$ for which
\begin{equation}\label{axioma-again}
   L_x x = Sx
\end{equation}
and
\begin{equation}\label{axiomb-again}
  L_{Sy} L_x L_x y = x
\end{equation}
for all $y \in G$ (note that $L_{Sy}$ is already fully constructed).

Define a \emph{seed} to be an injective partial function $L_x$ defined on finitely many values and obeying \Cref{axioma-again}, as well as \Cref{axiomb-again} whenever $L_x L_x y$ is defined.  If there is a $y \in G$ for which $L_x y$ is currently undefined, then by hypothesis $y$ is equal to $L_x z$ for at most one $z$.  If such a $z$ exists, we set $L_x y$ to be an element of $\{ w: L_{Sz} w = x \}$ that is not already in the domain or range of $L_x$; if no such $z$ exists, we set $L_x y$ to be arbitrary element of $G$ not already in the domain or range.  In either case, we see that the seed property is preserved.  Starting from the seed in which $L_x$ is only defined on $x$ and maps it to $Sx$, we obtain the claim.
\end{proof}

\begin{corollary}\label{1516-no-255}  There exists a 1516 magma that does not obey the 255 equation $$x = ((x \op x) \op x) \op x$$.
\end{corollary}

\begin{proof}  We perform the above construction, but with one refinement.  Pick some $x \in G'$.  Then after the constructions in \Cref{axiom-b}, $L_{Sx} x$ is defined and equal to some element $y$ distinct from $x$. If $y \in \Z$ then $L_y x \neq x$ by construction and we are done, so suppose $y \in G'$.  It is then a routine matter to modify the construction in \Cref{axiom-c} to ensure that $L_y x \neq x$, by adding one more element to the seed for $L_y$ to set $L_y x$ to some arbitrary value not equal to $x, y, Sy$.
\end{proof}
