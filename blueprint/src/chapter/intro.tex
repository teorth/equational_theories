\chapter{Basic theory of magmas}\label{basic-theory-chapter}
\begin{definition}[Magma]\label{magma-def}\lean{Magma}\leanok
  A \emph{magma} is a set $G$ equipped with a binary operation $\op: G \times G \to G$.
  A \emph{homomorphism} $\varphi : G \to H$ between two magmas is a map such that $\varphi(x \op y) = \varphi(x) \op \varphi(y)$ for all $x,y \in G$.
  An \emph{isomorphism} is an invertible homomorphism.
\end{definition}

Groups, semi-groups, and monoids are familiar examples of magmas. However, in general we do not expect magmas to have any associative properties. In some literature, magmas are also known as groupoids, although this term is also used for a slightly different object (a category with inverses).

A magma is called \emph{empty} if it has cardinality zero, \emph{singleton} if it has cardinality one, and \emph{non-trivial} otherwise.

The number of magma structures on a set $G$ of cardinality $n$ is of course $n^{n^2}$, which is \footnote{All sequences start from $n=0$ unless otherwise specified.}
$$ 1, 1, 16, 19683, 4294967296, 298023223876953125, \dots$$
(\href{https://oeis.org/A002489}{OEIS A002489}).
Up to isomorphism, the number of finite magmas of cardinality $n$ up to isomorphism is the slightly slower growing sequence
$$ 1, 1, 10, 3330, 178981952, 2483527537094825, 14325590003318891522275680, \dots$$
(\href{https://oeis.org/A001329}{OEIS A001329}).

\begin{definition}[Free Magma]\label{free-magma-def}\lean{FreeMagma}\leanok\uses{magma-def}
  The \emph{free magma} $M_X$ generated by a set $X$ (which we call an \emph{alphabet}) is the set of all finite formal expressions built from elements of $X$ and the operation $\op$.
  An element of $M_X$ will be called a \emph{word} with alphabet $X$.
  The \emph{order} of a word is the number of $\op$ symbols needed to generate the word.
  Thus for instance $X$ is precisely the set of words of order $0$ in $M_X$.
\end{definition}

For sake of concreteness, we will take the alphabet $X$ to default to the natural numbers $\N$ if not otherwise specified.

For instance, if $X = \{0,1\}$, then $M_X$ would consist of the following words:
\begin{itemize}
  \item $0$, $1$ (the words of order $0$);
  \item $0 \op 0$, $0 \op 1$, $1 \op 0$, $1 \op 1$ (the words of order $1$);
  \item $0 \op (0 \op 0)$, $0 \op (0 \op 1)$, $0 \op (1 \op 0)$, $0 \op (1 \op 1)$, $1 \op (0 \op 0)$, $1 \op (0 \op 1)$, $1 \op (1 \op 0)$, $1 \op (1 \op 1)$, $(0 \op 0) \op 0$, $(0 \op 0) \op 1$, $(0 \op 1) \op 0$, $(0 \op 1) \op 1$, $(1 \op 0) \op 0$, $(1 \op 0) \op 1$, $(1 \op 1) \op 0$, $(1 \op 1) \op 1$ (the words of order $2$);
  \item etc.
\end{itemize}

\begin{lemma} \leanok \lean{FreeMagma.elementsOfNumNodesEq_card_eq_catalan_mul_pow}
  For a finite alphabet $X$, the number of words of order $n$ is $C_n |X|^{n+1}$, where $C_n$ is the $n^{\mathrm{th}}$ Catalan number and $X$ is the cardinality of $X$.
\end{lemma}

\begin{proof} \leanok
  Follows from standard properties of Catalan numbers.
\end{proof}

The first few Catalan numbers are
$$ 1, 1, 2, 5, 14, 42, 132, \dots$$
(\href{https://oeis.org/A000108}{OEIS A000108}).

\begin{definition}[Induced homomorphism]\label{induced-def}\uses{free-magma-def}
  Given a function $f: X \to G$ from an alphabet $X$ to a magma $G$, the \emph{induced homomorphism} $\varphi_f: M_X \to G$ is the unique extension of $f$ to a magma homomorphism.
  Similarly, if $\pi \colon X \to Y$ is a function, we write $\pi_* \colon M_X \to M_Y$ for the unique extension of $\pi$ to a magma homomorphism.
\end{definition}

For instance, if $f : \{0,1\} \to G$ maps $0,1$ to $x,y$ respectively, then
$$ \varphi_f(0 \op 1) = x \op y$$
$$ \varphi_f(1 \op (0 \op 1)) = y \op (x \op y)$$
and so forth. If $\pi \colon \N \to \N$ is the map $\pi(n) := n+1$, then
$$ \pi_*(0 \op 1) = 1 \op 2$$
$$ \pi_*(1 \op (0 \op 1)) = 2 \op (1 \op 2)$$
and so forth.

\begin{definition}[Law]\label{law-def}
  \lean{Law.MagmaLaw}\leanok
  \uses{induced-def}
  Let $X$ be a set. A \emph{law} with alphabet $X$ is a formal expression of the form $w \formaleq w'$,
  where $w, w' \in M_X$ are words with alphabet $X$ (thus one can identify laws with alphabet $X$
  with elements of $M_X \times M_X$).
  A magma $G$ \emph{satisfies} the law $w \formaleq w'$ if
  we have $\varphi_f( w ) = \varphi_f ( w' )$ for all $f: X \to G$, in which case we write
  $G \models w \formaleq w'$.
\end{definition}

Thus, for instance, the commutative law
\begin{equation}\label{comm-law}
  0 \op 1 \formaleq 1 \op 0
\end{equation}
is satisfied by a magma $G$ if and only if
\begin{equation}\label{comm-law-2}
 x \op y = y \op x
\end{equation}
for all $x, y \in G$. We refer to \Cref{comm-law-2} as the \emph{equation} associated to the law \Cref{comm-law}. One can think of equations as the ``semantic'' interpretation of a ``syntactic'' law. However, we shall often abuse notation and identify a law with its associated equation. In particular, we shall (somewhat carelessly) also refer to \Cref{comm-law-2} as ``the commutative law'' (rather than ``the commutative equation'').

\begin{definition}[Models]\label{models-def}
  \lean{models}\leanok
  \uses{law-def}
  A \emph{theory} is a set $\Gamma$ of laws.
  Given a theory $\Gamma$, a magma $G$ is a \emph{model} of $\Gamma$ with the
  (overloaded) notation $G\models\Gamma$ if $G\models w\formaleq w'$ for every $w\formaleq w'$ in $\Gamma$; we also say that $G$ \emph{obeys} $\Gamma$.
  Given a law $E$, we write $\Gamma \models E$ if every magma $G$ that models $\Gamma$, also models $E$.
\end{definition}

\begin{definition}[Derivation]\label{derivation-def}
  \lean{derive}\leanok
  \uses{law-def}
  Given a theory $\Gamma$ and a law $w\formaleq w'$ over a fixed alphabet $X$, we say that
  $\Gamma$ \emph{derives} $w\formaleq w'$, and write $\Gamma\vdash w\formaleq w'$, if the law can
  be obtained using a finite number of applications of the following rules:
  \begin{enumerate}
    \item if $w\formaleq w' \in \Gamma$, then $\Gamma\vdash w\formaleq w'$.
    \item $\Gamma\vdash w\formaleq w$ for any word $w$.
    \item if $\Gamma\vdash w\formaleq w'$, then $\Gamma\vdash w'\formaleq w$.
    \item if $\Gamma\vdash w\formaleq w'$ and $\Gamma\vdash w'\formaleq w''$, then $\Gamma\vdash w\formaleq w''$.
    \item if $\Gamma\vdash w\formaleq w'$, then $\Gamma\vdash \varphi_f(w) \formaleq \varphi_f(w')$ for every $f: X \to M_X$.
    \item if $\Gamma\vdash w_1\formaleq w_2$ and $\Gamma\vdash w_3\formaleq w_4$, then $\Gamma\vdash w_1 \op w_3\formaleq w_2\op w_4$.
  \end{enumerate}
\end{definition}

This definition is useful because of the following theorem:

\begin{theorem}[Birkhoff's completeness theorem]\label{sound-complete}\lean{Completeness}\leanok\uses{models-def, derivation-def}
  For any theory $\Gamma$ and words $w, w'$ over a fixed alphabet
  $$ \Gamma\vdash w\formaleq w'\ \mathrm{iff}\ \Gamma\models w\formaleq w'.$$
\end{theorem}

\begin{proof}
  \leanok
  (Sketch) The `only if' component is soundness, and follows from verifying that the rules of inference in \Cref{derivation-def} holds for $\models$. The `if' part is completeness, and is proven by constructing the magma of words, quotiented out by the relation $\Gamma \vdash w \formaleq w'$, which is easily seen to be an equivalence relation respecting the magma operation.
\end{proof}

\begin{corollary}[Compactness theorem]\label{compactness-thm}\uses{models-def}
  Let $\Gamma$ be a theory, and let $E$ be a law.
  Then $\Gamma \models E$ if and only if there exists a finite subset $\Gamma'$ of $\Gamma$ such that $\Gamma' \models E$.
\end{corollary}

\begin{proof}\uses{sound-complete}
  The claim is obvious for $\vdash$, and the claim then follows from \Cref{sound-complete}.
\end{proof}

\begin{lemma}[Pushforward]\label{push}\uses{law-def}
  Let $w \formaleq w'$ be a law with some alphabet $X$, $G$ be a magma, and $\pi: X \to Y$ be a function.
  If $G \models w \formaleq w'$, then $G \models \pi_*(w) \formaleq \pi_*(w')$.
  In particular, if $\pi$ is a bijection, the statements $G \models w \formaleq w'$ and $G \models \pi_*(w) \formaleq \pi_*(w')$ are equivalent.
\end{lemma}

\begin{proof}
  Trivial.
\end{proof}

If $\pi$ is a bijection, we will call $\pi_*(w) \formaleq \pi_*(w')$ a \emph{relabeling} of the law $w \formaleq w'$. Thus for instance
$$ 5 \op 7 \formaleq 7 \op 5$$
is a relabeling of the commutative law \Cref{comm-law}. By the above lemma, relabeling does not affect whether a given magna satisfies a given law.

\begin{lemma}[Equivalence]\label{equiv}\uses{law-def}
  Let $G$ be a magma and $X$ be an alphabet.
  Then the relation $G \models w \formaleq w'$ is an equivalence relation on $M_X$.
\end{lemma}

\begin{proof}
  Trivial.
\end{proof}

Define the total order of a law $w \formaleq w'$ to be the sum of the orders of $w$ and $w'$.

\begin{lemma}[Counting laws up to relabeling]\label{law-count}\uses{push}
  Up to relabeling, the number of laws $w \formaleq w'$ of total order $n$ is $C_{n+1} B_{n+2}$.
\end{lemma}

\begin{proof}
  Follows from the properties of Catalan and Bell numbers.
\end{proof}

The first few Bell numbers are
$$ 1, 1, 2, 5, 15, 52, 203, \dots$$
(\href{https://oeis.org/A000110}{OEIS A000110}).

The sequence in \Cref{law-count} is
$$ 2, 10, 75, 728, 8526, 115764, \dots$$
(\href{https://oeis.org/A289679}{OEIS A289679}).

Now we would also like to count laws up to relabeling and symmetry.

\begin{lemma}[Counting laws up to relabeling and symmetry]\label{law-count-sym}\uses{push}
  Up to relabeling and symmetry, the number of laws $w \formaleq w'$ of total order $n$ is
  $$ C_{n+1} B_{n+2}/2$$
  when $n$ is odd, and
  $$ (C_{n+1} B_{n+2} + C_{n/2} (2D_{n+2} - B_{n+2}))/2$$
  when $n$ is even, where $D_n$ is the number of partitions of $[n]$ up to reflection.
\end{lemma}

\begin{proof}
  Elementary counting.
\end{proof}

The sequence $D_n$ is
$$ 1, 1, 2, 4, 11, 32, 117, \dots$$
(\href{https://oeis.org/A103293}{OEIS A103293}), and the sequence in \Cref{law-count-sym} is
$$ 2, 5, 41, 364, 4294, 57882, 888440, \dots$$
(\href{https://oeis.org/A376620}{OEIS A376620}).

We can also identify all laws of the form $w \formaleq w$ with the trivial law $0 \formaleq 0$. The number of such laws of total order $n$ is zero if $n$ is odd, and $C_{n/2} B_{n/2+1}$ if $n$ is even. We conclude:

\begin{lemma}[Counting laws up to relabeling, symmetry, and triviality]\label{law-count-triv}\uses{law-count-sym}
  Up to relabeling, symmetry, and triviality, the number of laws of total order $n$ is
  $$ C_{n+1} B_{n+2}/2$$
  if $n$ is odd, $2$ if $n = 0$, and
  $$ (C_{n+1} B_{n+2} + C_{n/2} (2D_{n+2} - B_{n+2}))/2 - C_{n/2} B_{n/2+1}$$
  if $n \geq 2$ is even.
\end{lemma}

\begin{proof}
  Routine counting.
\end{proof}

This sequence is
$$2, 5, 39, 364, 4284, 57882, 888365, \dots$$
(\href{https://oeis.org/A376640}{OEIS A376640}).

In particular, up to relabeling, symmetry, and triviality, there are exactly $2+5+39+364+4284=4694$ laws of total order at most $4$. A list can be found \href{https://github.com/teorth/equational_theories/blob/main/data/equations.txt}{here}. A script for generating them may be found \href{https://github.com/teorth/equational_theories/blob/main/scripts/generate_eqs_list.py}{here}. The ordering of these equations is according to the following rules.
First, an ordering on expressions with placeholder variables $\ast$ (such as $\ast \op (\ast \op \ast)$):
\begin{itemize}
\item (i)  Expressions of lower order come before expressions of higher order.
\item (ii) Expressions $w_L \op w_R$ of a given total order that is at least one are ordered lexicographically first by the ordering on the left component $w_L$, and then by the ordering on the right component $w_R$ if the left components agree.
\end{itemize}
For instance, $\ast \op \ast$ is less than $\ast \op (\ast \op \ast)$, which is less than $(\ast \op \ast) \op \ast$.

Then, we order placeholder equations such as $\ast \op (\ast \op \ast) \formaleq (\ast \op \ast) \op \ast$, where both sides are given placeholder variables:
\begin{itemize}
\item (i)  Equations of lower total order come before equations of higher total order.
\item (ii) Equations $w \formaleq w'$ of a given total order are ordered lexicographically first by the ordering on the left-hand side $w$, and then by the ordering on the right hand side $w'$ if the left-hand sides agree.
\end{itemize}
For instance, $\ast \op \ast \formaleq \ast \op (\ast \op \ast)$ is less than $\ast \op \ast \formaleq (\ast \op \ast) \op \ast$.

Finally, we order (and reduce) equations of the form $w \formaleq w'$ as follows. Define the \emph{shape} of an equation to be the equation in which all variables are replaced by placeholders $\ast$.
\begin{itemize}
  \item (i) Equations of lower shape will be of lower order.  For instance, any equation of shape $\ast \op \ast \formaleq \ast \op (\ast \op \ast)$ is less than any equation $\ast \op \ast \formaleq (\ast \op \ast) \op \ast$.
  \item (ii) Among equations of equations of equal shape, equations whose variables are first in the lexicographical ordering will be lower. For instance, $0 \ast 0 \formaleq 0 \op (0 \op 0)$ is less than $0 \ast 0 \formaleq 1 \op (1 \op 1)$, which is in turn less than $0 \ast 1 \formaleq 0 \op (0 \op 0)$.
  \item (iii) Only the arrangement of the equation (up to relabeling and symmetry) which is minimal in this ordering is retained in the list.  For instance, we do not retain $1 \op 2 \formaleq 1$ because it can be replaced by $0 \formaleq 0 \op 1$, which is earlier in the ordering.
\item (iv) Any trivial equation $w \formaleq w$, other than the order zero law $0 \formaleq 0$, is discarded.
\end{itemize}

\subsection{Alternate formula}

For integers $0 \le a \le b$ let $\fbox{E(a,b)}$ be the number of magma equations $t_1 = t_2$ with $t_1$ of order $a$, $t_2$ of order $b$, counting up to relabelling, up to switching terms, and only allowing the equation $x=x$ of the form $t=t$.  Then one has

\begin{itemize}
\item $E(0,0) = 2$.
\item  If \fbox{$a\neq b$}:
$$
E(a,b) = T(a)\cdot T(b) \cdot \sum_{\substack{1 \le p \le a+1\\ 1 \le q \le b+1\\0\le s \le \min(p,q)}}
{a+1 \brace p} {b+1 \brace q} {p \choose s} {q \choose s} s! \ .
$$
\item If \fbox{$a= b > 0$}:
\begin{multline*}
E(a,b) = \frac{1}{2} T(a)^2\cdot \sum_{\substack{1 \le p,q \le a+1\\ 0\le s \le \min(p,q)}}
{a+1 \brace p} {a+1 \brace q} {p \choose s} \binom{q}{s} s! \\
+ \frac{1}{2} T(a) \cdot \sum_{\substack{1 \le p \le a+1\\ 0\le s \le p}}
{a+1 \brace p}  \binom{p}{s} {\sf Invol}(s)\\
- T(a)\cdot \sum_{1\le p \le a+1}  {a+1 \brace p} \ .
\end{multline*}
\end{itemize}

Here the {\it Stirling numbers $n \brace m$ of the second kind} count the number of ways to partition a set of $n$ elements into $m$ non-empty subsets,
$$
T(n) \coloneq \frac{1}{n+1} \cdot \binom{2n}{n}
$$
counts the number of plane binary trees of order $n$, and.
$$
{\sf Invol}(n) = \sum_{0 \leq k \leq \lfloor n/2 \rfloor}  {n\choose 2k} (2k-1)!!
$$
counts the number of involutions on $n$ elements.

The number of magma equations of order $n$ (under the given constraints) is then equal to
$$\sum_{0 \le a \le \lfloor n/2 \rfloor } E(a,n-a) .
$$
For further details, as well as Maple calculations for $E(a,b)$, see \href{https://github.com/teorth/equational_theories/tree/main/scripts/count_magma_eqns}{this folder}.
