\chapter{Infinite magma constructions}\label{infinite-magma-constructions-chapter}

The need to construct infinite magmas primarily arises in the context of \emph{Austin laws} and \emph{Austin pairs}.
An Austin law admits infinite models but no nontrivial finite ones, while an Austin pair consists of
laws $P$ and $Q$ such that every finite model obeying the law $P$ also obeys $Q$, but some
infinite magma obeys $P$ without also obeying $Q$. Examples are given in \Cref{infinite-model-chapter}.

Here we survey techniques for constructing infinite magmas that serve as counterexamples for implications
between laws. Many of the techniques presented trace their origins to the first analysis of the Asterix equation
(\Cref{eq65}), reviewed in \Cref{asterix-section}.

\section{Translation-invariant magmas}

A \emph{translation-invariant magma} is a magma whose carrier $G$ is an Abelian group $G = (G,+)$, and whose magma operation takes the form
$$ y \op x = x + f(x-y)$$
for some function $f: G \to G$.  Thus the translations on $G$ become magma isomorphisms.

\begin{example}
  A magma $G$ satisfying the left (\Cref{eq4}) or right (\Cref{eq5}) absorption laws is translation-invariant.
  Equip the carrier $G$ with an Abelian group structure $(G,+,-,0)$ and define $f: G \to G$ as either $f(x) = -x$ or $f(x) = 0$.
\end{example}

\begin{example}
  Linear magmas $x\op y = ax+by$ on a field $(\mathbb{F},+,-,\cdot,0,1)$ are translation-invariant if $a + b = 1$,
  since $(\mathbb{F},+,-,0)$ forms an Abelian group, and one can set $f(x) = -ax$.
\end{example}

Note that if an example of the latter sort suffices to refute the implication between $P$ and $Q$ then
by the Lefschetz principle one can construct a counterexample where the field $\mathbb{F}$ is finite.
Consequently, $P$ and $Q$ cannot constitute an Austin pair. However, these linear magmas can still serve
as starting points for the \emph{modified translation-invariant} models studied in \Cref{infinite-examples-section}.

\section{The Asterix equation}\label{asterix-section}

Over translation-invariant magmas, equational laws simplify to univariate functional equations.

For instance, writing $x = y+h$, we have
$$ y \op x = x + f(h)$$
$$ x \op (y \op x) = x + f(h) + f^2(h)$$
$$ y \op (x \op (y \op x)) = x + f(h) + f^2(h) + f( h + f(h) + f^2(h) )$$
where $f^2 = f \circ f$, so the Asterix equation (\Cref{eq65}) for such magmas simplifies to the univariant functional equation
\begin{equation}\label{fh}
   f(h) + f^2(h) + f( h + f(h) + f^2(h) ) = 0
\end{equation}
for $h \in G$.

This equation has some degenerate solutions, for instance we can take $f(h) = c$ for any constant $c$ of order $3$ in $G$.  It is challenging to construct more interesting solutions to this equation; however, we can do this if $G=\Z$ by a greedy algorithm.  We need the following technical definition.

\begin{definition}\label{partial-solution}  A \emph{partial solution} $(E_0, E_1, E_2, f)$ to \Cref{fh} consists of nested finite sets
$$ E_0 \subset E_1 \subset E_2 \subset \Z$$ together with a function $f: E_1 \to E_2$ with the following properties:
\begin{description}
  \item[(a)] If $h \in E_0$, then $f(h) \in E_1$, so that $f^2(h)$ is well-defined as an element of $E_2$; furthermore, $h + f(h) + f^2(h)$ lies in $E_1$, so that the left-hand side of \Cref{fh} makes sense; and \Cref{fh} holds.
  \item[(b)] The function $f$ is a bijection from $E_1 \backslash E_0$ to $E_2 \backslash E_1$.
\end{description}

We partially order the space of partial solutions to \Cref{fh} by writing $(E_0, E_1, E_2, f) \leq (E'_0, E'_1, E'_2, f')$ if the following properties hold:
\begin{itemize}
  \item $E_i \subset E'_i$ for $i=0,1,2$.
  \item $f$ agrees with $f'$ on $E_0$.
\end{itemize}
When this occurs we say that the partial solution $(E'_0, E'_1, E'_2, f')$ \emph{extends} the partial solution $(E_0, E_1, E_2, f)$.

We define the \emph{empty partial solution} $(E_0,E_1,E_2,f)$ by setting $E_0=E_1=E_2$ to be the empty set, and $f$ to be the empty function; it is the minimal element of the above partial order.
\end{definition}


We have the following iterative construction, that lets us add arbitrary elements to the core domain $E_0$:

\begin{lemma}[Enlarging a partial solution]\label{iteration}\uses{partial-solution} Let $(E_0, E_1, E_2, f)$ be a partial solution to \Cref{fh}, and let $h$ be an element of $\Z$ that does not lie in $E_0$.  Then there exists a partial solution $(E'_0, E'_1, E'_2, f')$ to \Cref{fh} that extends $(E_0, E_1, E_2, f)$, such that $h \in E_0'$.
\end{lemma}

\begin{proof}  Because $f$ maps $E_1 \backslash E_0$ bijectively to $E_2 \backslash E_1$, there are three cases:
\begin{itemize}
  \item $h$ is equal to an element $h_0$ of $G \backslash E_2$.
  \item $h$ is equal to an element $h_0$ of $E_1 \backslash E_0$.
  \item $h$ is equal to $h_1 = f(h_0)$ for some $h_0 \in E_1 \backslash E_0$, so that $h_1 \in E_2 \backslash E_1$.
\end{itemize}

We deal with these three cases in turn.

First suppose that $h = h_0\in G \backslash E_2$.  We perform the following construction.

\begin{itemize}
  \item Choose an element $h_1 \in \Z$ that does not lie in $E_2 \cup \{h_0\}$; this is possible because $E_2$ is finite.
  \item Choose an element $h_2 \in \Z$ such that $h_2, h_0+h_1+h_2$, and $-h_1-h_2$ are all distinct from each other and lie outside of $E_2 \cup \{h_0, h_1\}$; this is possible because $E_2$ is finite.
  \item Promote $h_0$ to $E_0$, promote $h_1, h_0+h_1+h_2$ to $E_1$, and promote $h_2, -h_1-h_2$ to $E_2$, creating new sets
  \begin{align*}
    E'_0 &:= E_0 \cup \{h_0\} \\
    E'_1 &:= E_1 \cup \{h_0, h_1, h_0+h_1+h_2\} \\
    E'_2 &:= E_2 \cup \{h_0, h_1, h_0+h_1+h_2, h_2, -h_1-h_2\}.
  \end{align*}
  Clearly we still have nested finite sets $E'_0 \subset E'_1 \subset E'_2$.
  \item Extend $f : E_1 \to E_0$ to a function $f': E'_1 \to E'_0$ by defining
  \begin{align*}
    f'(h_0) &:= h_1 \\
    f'(h_1) &:= h_2 \\
    f'(h_0+h_1+h_2) &:= -h_1-h_2
  \end{align*}
  while keeping $f'(h)=f(h)$ for all $h \in E_1$.
\end{itemize}
It is then a routine matter to verify that $(E'_0,E'_1,E'_2,f')$ is a partial solution to \Cref{fh} extending $(E_0,E_1,E_2,f)$ and that $E'_0$ contains $h_0$, as required.

Now suppose that $h = h_0 \in E_1 \backslash E_0$, then the quantity $h_1 := f(h_0)$ lies in $E_2 \backslash E_1$.  We perform the following variant of the above construction:
\begin{itemize}
\item Choose an element $h_2 \in \Z$ such that $h_2, h_0+h_1+h_2$, and $-h_1-h_2$ are all distinct and lie outside of $E_2$.  This is possible because $E_2$ is finite.
\item Promote $h_0$ to $E_0$, promote $h_1$ and $h_0+h_1+h_2$ to $E_1$, and promote $h_2, -h_1-h_2$ to $E_2$, thus creating new sets
\begin{align*}
  E'_0 &:= E_0 \cup \{h_0\} \\
  E'_1 &:= E_1 \cup \{h_1, h_0+h_1+h_2\} \\
  E'_2 &:= E_2 \cup \{h_0+h_1+h_2, h_2, -h_1-h_2\}.
\end{align*}
Clearly we still have nested finite sets $E'_0 \subset E'_1 \subset E'_2$.
\item Extend $f : E_1 \to E_0$ to a function $f': E'_1 \to E'_0$ by defining
\begin{align*}
  f'(h_1) &:= h_2 \\
  f'(h_0+h_1+h_2) &:= -h_1-h_2
\end{align*}
while keeping $f'(h)=f(h)$ for all $h \in E_1$.
\end{itemize}
It is then a routine matter to verify that $(E'_0,E'_1,E'_2,f')$ is a partial solution to \Cref{fh} extending $(E_0,E_1,E_2,f)$ and that $E'_0$ contains $h_0$, as required.

Finally, suppose that $h = h_1 = f(h_0)$ for some $h_0 \in E_1 \backslash E_0$, so that $h_1 \in E_2 \backslash E_1$.  Then we perform the following algorithm.
\begin{itemize}
  \item Choose an element $h_2 \in \Z$ such that $h_2, h_0+h_1+h_2$, and $-h_1-h_2$ are all distinct and lie outside of $E_2$.  This is possible because $E_2$ is finite.
  \item Choose an element $h_3 \in \Z$ such that $h_3, h_1+h_2+h_3$, and $-h_2-h_3$ are all distinct and lie outside of $E_2 \cup \{h_2, h_0+h_1+h_2,-h_1-h_2\}$.  This is possible because $E_2$ is finite.
  \item Promote $h_0, h_1$ to $E_0$, promote $h_2, h_0+h_1+h_2, h_1+h_2+h_3$ to $E_1$, and promote $h_3, -h_1-h_2,-h_2-h_3$ to $E_2$, creating new sets
\begin{align*}
  E'_0 &:= E_0 \cup \{h_0, h_1 \}\\
  E'_1 &:= E_1 \cup \{h_1, h_2, h_0+h_1+h_2, h_1+h_2+h_3 \}\\
  E'_2 &:= E_2 \cup \{h_2, h_3, h_0+h_1+h_2, h_1+h_2+h_3, -h_1-h_2, -h_2-h_3\}.
\end{align*}
Clearly we still have nested finite sets $E'_0 \subset E'_1 \subset E'_2$.
\item Extend $f : E_1 \to E_0$ to a function $f': E'_1 \to E'_0$ by defining
\begin{align*}
  f'(h_1) &:= h_2 \\
  f'(h_0+h_1+h_2) &:= -h_1-h_2
  f'(h_2) &:= h_3 \\
  f'(h_1+h_2+h_3) &:= -h_2-h_3
\end{align*}
while keeping $f'(h)=f(h)$ for all $h \in E_1$.
\end{itemize}
It is then a routine matter to verify that $(E'_0,E'_1,E'_2,f')$ is a partial solution to \Cref{fh} extending $(E_0,E_1,E_2,f)$ and that $E'_0$ contains $h_0$, as required.
\end{proof}

\begin{corollary} \label{extend}\uses{partial-solution} Every partial solution $(E_0,E_1,E_2,f)$ to \Cref{fh} can be extended to a full solution $\tilde f: \Z \to \Z$.
\end{corollary}

\begin{proof}\uses{iteration}
  If we arbitrarily well-order the integers, and iterate \Cref{iteration} to add the least element of $\Z \backslash E_0$ in this well-ordering to $E_0$, we obtain an increasing sequence $(E^{(n)}_0, E^{(n)}_1, E^{(n)}_2, f^{(n)})$ of partial solutions to \Cref{fh}, where the $E^{(n)}_0$ exhaust $\Z$: $\bigcup_{n=1}^\infty E^{(n)}_0 = \Z$.  Taking limits, we obtain a full solution $\tilde f$.
\end{proof}

\begin{corollary}\label{no-inject}  There exists a solution $f:\Z \to \Z$ to \Cref{fh} such that the map $h \mapsto h + f(h)$ is not injective.
\end{corollary}

\begin{proof}  Select integers $h_0,h_1,h_2,h'_0,h'_1,h'_2$ such that the quantities
  $$ h_0, h_1, h_2, h_0+h_1+h_2, -h_1-h_2, h'_0, h'_1, h'_2, h'_0+h'_1+h'_2, -h'_1-h'_2$$
  are all distinct, but such that
  $$ h_0 + h_1 = h'_0 + h'_1$$
  (there are many assignments of variables that accomplish this).  Then set
\begin{align*}
  E_0 &:= \{h_0, h'_0\}\\
  E_1 &:= E_0 \cup \{ h_1, h'_1, h_0+h_1+h_2, h'_0+h'_1+h'_2\}\\
  E_2 &:= E_2 \cup \{ -h_1-h_2, -h'_1-h'_2\}
\end{align*}
and define $f: E_1 \to E_2$ by the formulae
\begin{align*}
  f(h_0) &:= h_1 \\
  f(h_1) &:= h_2 \\
  f(h_0+h_1+h_2) &:= -h_1-h_2 \\
  f(h'_0) &:= h'_1 \\
  f(h'_1) &:= h'_2 \\
  f(h'_0+h'_1+h'_2) &:= -h'_1-h'_2.
\end{align*}
One can then check that $(E_0, E_1, E_2, f)$ is a partial solution to \Cref{fh}, and by construction $h \mapsto h + f(h)$ is not injective on $E_1$.  Using \Cref{iteration} to extend this partial solution to a full solution, we obtain the claim.
\end{proof}

\begin{corollary}[Asterix does not imply Obelix]\label{asterix-obelix}\uses{eq65,eq1491}  There exists a magma obeying the Asterix law (\Cref{eq65}) with carrier $\Z$ such that the left-multiplication maps $L_y: x \mapsto y \op x$ are not injective for any $y \in \Z$.  In particular, it does not obey the Obelix law (\Cref{eq1491}).
\end{corollary}

\begin{proof}\uses{no-inject} Note that $L_y (y+h) = y + h + f(h)$, so the injectivity of the left-multiplication maps is equivalent to the injectivity of the map $h \mapsto h + f(h)$.  The non-injectivity then follows from \Cref{no-inject}. Note that the Obelix law clearly expresses $x$ as a function of $y$ and $L_y x = y \op x$, forcing injectivity of left-multiplication, so the Obelix law fails.
\end{proof}

On the other hand, for finite magmas the situation is different:

\begin{proposition}[Asterix implies Obelix for finite magmas]\label{asterix-obelix-finite}\uses{eq65,eq1491}  Any finite magma obeying the Asterix law (\Cref{eq65}) also is left-cancellative and obeys the Obelix law (\Cref{eq1491}).
\end{proposition}

\begin{proof}  From \Cref{eq65} we see the map $z \mapsto y \op z$ is surjective, hence injective on a finite magma; thus the magma is left-cancellative.  Replacing $x$ by $y \op x$ in this law, we see that
$$ y \op x = y \op ((y\op x) \op (y \op (y \op x)));$$
using injectivity, we conclude
$$ x = (y\op x) \op (y \op (y \op x))$$
which is \Cref{eq1491}.
\end{proof}

A very similar argument shows that a finite magma that obeys the Obelix law has $z \mapsto y \op z$ injective, hence surjective, and then obeys the Asterix law.

\section{Obelix}
Obelix magmas are those obeying equation 1491, \Cref{eq1491}:
$$x = (y \op x) \op (y \op (y \op x))$$
Obelix is not particularly {\em structurally} similar to an Asterix, besides their shared resistance
to small counterexamples. A related set of ideas can be used to construct an Obelix that does not
obey some given other equations. The common idea is to define the magma operation
$$ x \op y = x + f(y-x) = x + f(h)$$
on some underlying Abelian group. For the case of Obelix, the resulting functional equation is
\begin{equation}\label{fh2}
  f(f^{2}(h) - f(h)) = h - f(h)
\end{equation}
What differs is how we must proceed in order to satisfy this equation. We again start with a partial function $f$,
picking some initial support that will suffice to invalidate the other equation we want to show a nonimplication for.
We will progressively add more elements to the support (assuming our group is countable) until the function
is total, and we will maintain some invariants:
\begin{definition}\label{partial-solution2}  A \emph{partial solution} for an Obelix is a partial function $f : G \to G$
with the properties:
\begin{itemize}
  \item $f$ has finite domain.
  \item $f$ is injective.
  \item $f$ maps the identity (of $G$, so, 0) to the identity.
  \item If $x$ is in the domain of $f$, and $f(x)$ is in the domain, then so is $f^2(x) - f(x)$.
  \item If $x$ is in the domain of $f$, and $f(x)$ is in the domain, then $f(f^2(x) - f(x)) = f(x) - x$. This is well-defined by property (4).
  \item The function $x - f(x)$, which is defined on the same domain as $f$, is injective.
  \item If $x$ is in the domain of $f$ but $f(x)$ isn't in the domain, then $x - f(x)$ isn't in the domain or image of $f$.
\end{itemize}
\end{definition}
It's easiest to work over the group of finitely supported functions from $\mathbb{N}$ (or any other
countable set) to $\mathbb{Z}$. When picking fresh elements, it's important not only to take something
outside of the group closure of the elements already in $f$, but actually out of their $\mathbb{Q}$-span,
because we need guarantees that the fresh element $g$ doesn't obey relations like $2g = x$ as well.

Any partial solution can be extended to a complete solution.
\begin{lemma}\label{obelix-extend}\uses{partial-solution2}
For any $E\in \mathscr{E}$ and any $a\in G$, there is an extension $E\subseteq E'\in \mathscr{E}$ where the functional equation holds for $a$.
\end{lemma}
\begin{proof}
{\bf Case 1}: Assume $(a,b)\in E$ for some $b\in G$.

If $b\in {\rm dom}(E)$, then by condition (4) we are already done.  So reduce to the case when $b\notin {\rm dom}(E)$.  In particular, by (2) and (3) we know $a,b\neq 1$, and also by (6) we know that $ab^{-1}\notin {\rm dom}(E)\cup{\rm im}(E)$ (and is not $1$).

Take $c$ to be a generator of $G$ not appearing in the reduced form of any entry in $E$, and set $E':=E\cup\{(b,c),(cb^{-1},ab^{-1}\}$.  Conditions (1), (3), and (5) are immediate.  Condition (2) is also clear, where injectivity needs $ab^{-1}\notin {\rm im}(E)$.   Condition (4) is also easy to check, using the fact that $E$ is injective, $cb^{-1}\neq c$, and $ab^{-1}\notin {\rm dom}(E)$.

Finally, for condition (6), a finite check works.  The main case is checking that $ca^{-1}\notin {\rm dom}(E')\cup {\rm im}(E')$.  This is clear since $a\neq 1$ and $a\neq b$ (by condition (5) for $E$).  One should also note that by condition (5) (and the fact that $E$ is a function), there is no pair $(x,y)\in E$ with $(x,y)\neq (a,b)$ and  $xy^{-1}=ab^{-1}$, so we don't ruin condition (6) for pairs already in $E$.

{\bf Case 2}: Assume $a\notin {\rm dom}(E)$.  If $(x,a)\in E$ for some (unique by (2)) $x\in G$, then applying Case 1 to $x$, we reduce to the case when $a\in {\rm dom}(E)$.

Thus, we may consider the case when $a\notin {\rm dom}(E)\cup {\rm im}(E)$.  If $(x,y)\in E$ with $xy^{-1}=a$, then by applying Case 1 to $x$, we get $a\in {\rm im}(E)$, and reduce to a previously considered case.  So, we may assume there is no such pair $(x,y)$.  Fixing $b$ to be a generator of $G$ not appearing in the reduced forms for the entries in $E$, nor in $a$, then after passing to $E\cup\{(a,b)\}\in \mathscr{E}$ we again reduce to Case 1.
\end{proof}
The actual mechanical proof requires checking roughly a few dozen statements of the form "the fresh
element is not related linearly to the existing elements". Each is individually obvious, and easily
discharged.

By picking an appropriate partial solution, we can then show that there are Obelix magmas that are not Asterix.
\begin{corollary}\uses{eq65,eq1491,obelix-extend}
There is an Obelix magma that is not Asterix (equation 65).
\end{corollary}
\begin{proof}
This requires picking an initial set that still obeys the correct initial closure properties. Letting
$x_1$, $x_2$, $x_3$ and $x_4$ be independent elements, then taking the function
$$\{(0,0), (x_1,x_2), (x_2-x_1, x_3), (x_1+x_3, x_4)\}$$
already has elements that contradict the Asterix equation, and it's a valid partial solution. By extending
it, we can get an Obelix that does not obey the Asterix equation.
\end{proof}

\section{Greedy algorithm constructions}\label{greedy-section}

In \Cref{asterix-section} a magma obeying one law and refuting another was obtained by using the
fact that over translation-invariant magmas, equational laws simplify to univariate functional equations,
and solving the resulting equation using a greedy algorithm.

One way to construct infinite magmas obeying specific laws is via a greedy algorithm construction not on a
one-variable functional equation, but on the operation table of the magma itself.

Here, it is best to work with \emph{partially defined magma operations} on some carrier $G$.  These can be interpreted as ternary relations $R(x,y,z)$ in three variables $x,y,z \in G$ which pass the following ``vertical line test'':

\begin{description}
  \item[(VLT)] If $R(x,y,z)$ and $R(x,y,z')$ both hold for some $x,y,z,z' \in G$, then $z=z'$.
\end{description}

Such an operation is then associated (via a one-to-one correspondence) to a partially defined operation $\op : S \to G$ for some $S \subset G \times G$, with $R(x,y,z)$ holding if and only if $x \op y$ is well-defined (i.e., $(x,y) \in S$) and equal to $z$.  By abuse of notation, we shall also refer to $R$ as a partially defined magma operation.  Genuine magmas then correspond to the special case where $S = G \times G$, that is to say $x \op y$ is well-defined for all $x,y \in G$.

Given a word $w(x_1,\dots,x_n)$ in variables $x_1,\dots,x_n$ (so $w$ is an element of the free magma on $n$ generators), we can say that $w(x_1,\dots,x_n)$ is \emph{well-defined} with respect to a partially defined magma operation $R$ if it can be fully evaluated using $R$.  For instance, the word $(x \op y) \op z$ is well-defined if there exists $w,u \in G$ such that $R(x,y,w)$ and $R(w,z,u)$ both hold, in which case $(x \op y) \op z$ evaluates to $u$.  Note from the axiom (VLT) that this evaluation is unique, if it exists.  Of course, in a genuine magma, all expressions are well-defined.  We say that an expression $w(x_1,\dots,x_n)$ is \emph{almost well-defined} if all strict subexpressions of $w$ are well-defined.  For instance, $(x \op y) \op z$ is almost well-defined if there exists $w \in G$ such that $R(x,y,w)$ holds.

An equational law $w_1 \formaleq w_2$ involving some variables $x_1,\dots,x_n$ is said to be \emph{locally obeyed} by $R$ if,  whenever $w_1(x_1,\dots,x_n)$, $w_2(x_1,\dots,x_n)$ are almost well-defined, and one of the two expressions is well-defined and evaluates to some output $y$, then the other expression is also well-defined and evaluates to the same output $y$.  For instance, in order for $R$ to locally obey the associative law $(x \op y) \op z = x \op (y \op z)$ (\Cref{eq4512}), we require the following two axioms:
\begin{description}
  \item[(4512-1)] If $R(x,y,w)$, $R(w,z,u)$, and $R(y,z,v)$, then $R(x,v,u)$.
  \item[(4512-2)] If $R(y,z,w)$, $R(x,w,u)$, and $R(x,y,v)$, then $R(v,z,u)$.
\end{description}
If a law involves a single variable on one side, then we only need one axiom.  For instance, the Asterix law (\Cref{eq65}) is locally obeyed by $R$ if and only if the following axiom holds:
\begin{description}
  \item[(65)] If $R(y,x,z)$ and $R(x,z,u)$, then $R(y,u,x)$.
\end{description}
Note that if the relation $R$ is associated to a genuine magma operation $\op$, then it locally obeys a law $w_1 \formaleq w_2$ if and only if the magma operation $\op$ obeys the law $w_1 \formaleq w_2$.  For instance, the relation $R$ associated to a globally defined magma operation $\op$ obeys (4512-1) and (4512-2) if and only if the magma is associative.

More generally, one can ask for a ternary relation $R$ to obey some theory $\Gamma$ of universal laws, using the language of one ternary relation $R$, the equality symbol $=$, and possibly some constants (we will shortly introduce three constants $a,b,c$ for this purpose).

Suppose we have a relation $R$ obeying some theory $\Gamma$ (for instance, (VLT) together with (65)), but which is only finitely supported (there are only finitely many triples $(x,y,z)$ for which $R(x,y,z)$ holds).  Then one can find $a,b \in G$ such that $a \op b$ is currently undefined.  If the carrier $G$ is infinite (e.g., if $G = \N$), one can then find another element $c$ which is \emph{novel}: it is not equal to $a, b$, or any of the $x,y,z$ for which $R(x,y,z)$ hold. In other words, the relation $R$ and the constants $a,b,c$ obey the following additional axioms:
\begin{description}
  \item[(novel-1)] $c \neq a$ and $c \neq b$.
  \item[(novel-2)] If $R(x,y,z)$, then $c \neq x$, $c \neq y$, and $c \neq z$.
  \item[(undefined)]  $R(a,b,x)$ does not hold for any $x$.
\end{description}

Let us say that a theory $\Gamma$ is \emph{greedily extensible} if, whenever $R$ is a finitely supported ternary relation obeying $\Gamma$, and $a,b,c$ are constants obeying (novel-1), (novel-2), (undefined), then there exists an extension $R'$ of $R$, thus
\begin{description}
  \item[(extend)] $R(x,y,z) \implies R'(x,y,z)$ for all $x,y,z$,
\end{description}
which is also finitely supported and obeys $\Gamma$, and which also obeys the additional axiom
\begin{description}
  \item[(define)] $R'(a,b,c)$.
\end{description}
Informally, $R'$ is formed from $R$ by ``forcing'' $a \op b = c$ and then adding other axioms as needed. (Indeed, our construction here can be viewed as a simple analogue of the forcing construction in set theory.)

Observe that if a theory $\Gamma$ containing (VLT) is greedily extensible, then any finitely supported ternary relation $R$ obeying $\Gamma$ on a countably infinite carrier $G$ can be extended to a globally defined relation obeying $\Gamma$, by iteratively selecting the first $(a,b)$ (in some fixed enumeration of $G \times G$) for which $a \op b$ is undefined, and then selecting a novel element $c$ to define as $a \op b$, and applying the greedily extensible property, and then taking a direct limit of the countable sequence of relations thus produced.  This gives a flexible way to construct magmas that obey a given theory $\Gamma$, but which violate some other law $w_1 \formaleq w_2$, as the task then reduces to just finding a partial solution $R$ to $\Gamma$ and some constants $x_1,\dots,x_n$ for which the expressions $w_1(x_1,\dots,x_n), w_2(x_1,\dots,x_n)$ are already well-defined, but not equal to each other.

Unfortunately, most theories are not greedily extensible without further modification.  Consider for instance the theory $\Gamma$ consisting of (VLT) and the Asterix law (65).  Given $a,b,c$ and a finitely supported $R$ obeying $\Gamma$ as well as (novel-1), (novel-2), (undefined), we would like to construct a finitely supported  $R'$ obeying $\Gamma$, (extend), (define).  The naive guess would just be to take the minimal construction
$$ R'(x,y,z) \hbox{ iff } R(x,y,z) \hbox{ or } (x,y,z) = (a,b,c).$$
This can work, but there is an obstruction: if $R(w,a,b)$ for some $w$, then (65) forces $R'(w,c,a)$.  So one would have to enlarge the definition of $R'(x,y,z)$, to hold true if one of the following statements holds:
\begin{itemize}
  \item $R(x,y,z)$ holds.
  \item $(x,y,z) = (a,b,c)$.
  \item $(x,y,z) = (w,c,a)$ for some $w$ with $R(w,a,b)$.
\end{itemize}
This works more often, but there is then a second obstruction: if $R(b,a,b)$, then we now have $R'(b,c,a)$, and (65) then forces $R'(a,a,b)$.  So we need to add a fourth item to the above list defining $R'$:
\begin{itemize}
  \item $(x,y,z) = (a,a,b)$, assuming $R(b,a,b)$ holds.
\end{itemize}
But now if we had $R(a,a,z)$ for some $z \neq b$, this would then create a violation of (VLT).  To fix this, we need to extend $\Gamma$ by adding an additional axiom:
\begin{itemize}
  \item (65') If $R(y,x,y)$, then $R(x,x,y)$.
\end{itemize}
With this modification to $\Gamma$, if we run the above analysis, we now see that if $R(b,a,b)$ hold (so that $R(a,a,b)$ also holds), then (65) will force $R'(a,c,a)$, $R'(b,c,a)$, and $R'(c,c,a)$.  So now the modified definition of $R'$ is that $R'(x,y,z)$ holds if one of the following statements holds:
\begin{itemize}
  \item $R(x,y,z)$ holds.
  \item $(x,y,z) = (a,b,c)$.
  \item $(x,y,z) = (w,c,a)$ for some $w$ with $R(w,a,b)$.
  \item $(x,y,z) = (a,c,a)$, $(b,c,a)$, or $(c,c,a)$, assuming $R(b,a,b)$ holds.
\end{itemize}
One can then finally (for instance, with the assistance of a automated theorem prover) verify that if $R$ is finitely supported and obeys $\Gamma = (VLT) + (65) + (65')$ and $a,b,c$ obey (novel-1), (novel-2), (undefined), then the $R'$ defined above is also finitely supported and obeys $\Gamma$, (extend), (define).  This shows that the theory $\Gamma$ is greedily extensible.

Using this, one can for instance find a magma obeying \Cref{eq65} that fails the left-cancellative property
$$ y \op x = y \op x' \implies x=x'$$
or in terms of ternary relations
\begin{equation}\label{left-inject}
   R(y,x,z) \hbox{ and } R(y,x',z) \implies x=x'
\end{equation}
simply by starting with a partial solution, say on the natural numbers in which (e.g.) $R(1,2,0)$, $R(1,3,0)$ are the only situations in which $R$ holds.  One can easily verify that this obeys (VLT) and (65), (65'), but not \Cref{left-inject}, and so any magma constructed by the above greedy construction will not be left-cancellative.  Since the Obelix law \Cref{eq1491} forces left-cancellativity, this gives an alternate proof of \Cref{asterix-obelix}.

\subsection{Equation 1722}

We illustrate the above technique by constructing solutions to equation 1722,
\begin{equation}\label{1722}
  (y \op y) \op ((x \op y) \op y) = x.
\end{equation}
We abbreviate $Sy := y \op y$.

Define a \emph{partial solution} to be a partial function $\op: E \to \N$ on some finite subset $E$ of $\N \times \N$ (which one can also think of as a finitely supported ternary relation $R(x,y,z)$ obeying VLT) obeying the following axioms:
\begin{itemize}
\item (Law 1) If $(x \op y) \op y$ is defined, then $Sy \op ((x \op y) \op y)$ is defined and equal to $x$.
\item (Law 2) If  If $x \op y$ and $z \op y$ are defined and equal to each other, then $x=z$.
\item (Law 3) If $Sx$ is defined, then $(Sx \op x) \op x$ is defined.
\item (Law 4) If there exists a $z$ such that $z \op x = x$ then $x \op x$ is defined.
\end{itemize}

\begin{lemma}[1722 extension]\label{1722-extension}\leanok\lean{Eq1722.Greedy.lift}  Suppose that $\op$ is a partial solution, and $a \op b$ is currently undefined.  Then there exists an extension $\op'$ of $\op$ for which $a \op' b$ is defined.
\end{lemma}

\begin{proof}  Suppose first that $b=a$, so $a \op a$ is undefined, then by Law 4 we have $d \op a \neq a$ for all $d$ with $d \op a$ defined. Set $a_0=a$ and find nine distinct elements $a_1,a_2,a_3,a_4,b_0,b_1,b_2,b_3,b_4$ not previously appearing in the domain or range of $\op$. Extend the indices periodically by setting $a_{i+4} = a_i,b_{i+4} = b_i$ for $i \ge 1$, and define $a_i \op' a_i = a_{i+1}$ (so $a_i = S^i a$), $a_{i+1} \op' a_i = b_i$, $b_i \op' a_i = a_{i+2}$, $a_{i+3} \op' a_{i+1} = a_{i+1}$, $a_{i+1} \op' a_{i+2} = a_{i+1}$, $a_{i+1} \op' b_i = a_i$.  We also define $x \op' y = x \op y$ whenever the right-hand side is defined. It is easy to see that laws 2,3,4 are preserved (though for law 2 note that we have not defined $a_2 \op' a_0$ due to the way indices are extended). Now we case check Law 1.  \begin{itemize}
    \item Case 1. $y$ is fresh, that is $y \in \{a_1,a_2,a_3,a_4,b_0,b_1,b_2,b_3,b_4\}$. If $x \op' y$ is not defined, we are done, so assume this is so. In particular, $x  \in \{a_1,a_2,a_3,a_4,b_0,b_1,b_2,b_3,b_4\}$. If $x,y \in \{a_1,a_2,a_3,a_4\}$ we are done by construction. If $x = b_i$ for some $i$, then $y = a_i$ and we are again done by construction. Finally, if $y = b_i$ for some $i$, then $x = a_{i+1}$ and $(x \op' y) \op' y$ is undefined.
    \item Case 2. $x$ is fresh, that is $x \in \{a_1,a_2,a_3,a_4,b_0,b_1,b_2,b_3,b_4\}$. If we are not in Case 1 and $x \op' y$ is defined, we must have $y = a_0$ and $x \in \{a_1, b_0\}$. The case $x = a_1$ holds by construction, and the case $x = b_0$ holds as $a_2 \op' a_0$ is not defined.
    \item Case 3. $x,y \not \in  \{a_1,a_2,a_3,a_4,b_0,b_1,b_2,b_3,b_4\}$ and $x \op y$ was undefined. Then $x \op' y$ is undefined unless $x=y=a_0$, in which case Law 1 holds by construction.
    \item Case 4. $x,y \not \in  \{a_1,a_2,a_3,a_4,b_0,b_1,b_2,b_3,b_4\}$, $x \op y$ was defined, and $(x \op y) \op y$ was not defined. Then $(x \op' y) \op' y$ is undefined unless $(x \op y) = a = y$, but this is impossible by Law $4$ as already observed.
    \item Case 5. $x,y \not \in  \{a_1,a_2,a_3,a_4,b_0,b_1,b_2,b_3,b_4\}$ and $x \op y$ and $(x \op y) \op y$ were defined. Then the claim follows from Law 1 applied to $\op$.
\end{itemize}

Now suppose that $a \op b$ is undefined for some $a \neq b$.  By applying the previous construction, we may assume without loss of generality that $Sb$ is defined.  We may assume that $a \op b$ remains undefined after doing so, since we are done otherwise.  By Law 3, $a \neq Sb \op b$.  By Law 2, we have $d \op b = a$ for at most one $d$, which is necessarily different from $Sb$.  Choose a $c$ not previously appearing in the domain or range of $\op$, and set $a \op' b = c$.  If a $d$ exists as before, we additionally set $Sb \op' c = d$.  Finally we define $x \op' y = x \op y$ whenever the right-hand side is defined.
It is again routine to check that $\op'$ obeys Laws 2,3,4.  Now we case check Law 1.

\begin{itemize}
\item Case 1.  $x=c$ or $x \op' y = c$.  Not possible since no left multiplication by $c$ is defined.
\item Case 2.  $y=c$.  This would force $x = Sb$ and $d = Sb$, but this is not possible since $d$ is different from $Sb$.
\item Case 3: $(x \op' y) \op' y = c$. This forces $x=d$ and $y=b$, and the claim follows from construction.
\item Case 4: None of the terms in $(x \op' y) \op' y$ are equal to $c$.  Then the claim follows from Law 1 applied to $\op$.
\end{itemize}
\end{proof}

By the greedy algorithm, this implies that any partial solution can be extended to a 1722 magma on $\N$.  We can now refute the implication to equation 1832
$$ x = (x \op Sx) \op Sx,$$
equation 2644
$$ x = S^2 x \op x,$$
and equation 3050,
$$ x = ((Sx \op x) \op x) \op x$$
by using the partial solution
$$ 0 \op 0 = 1, 0 \op 1 = 2, 1 \op 0 = 2, 1 \op 1 = 3, 1 \op 2 = 0, 1 \op 3 = 1, 1 \op 4 = 2$$
$$ 2 \op 0 = 3, 2 \op 1 = 4, 3 \op 0 = 4, 3 \op 1 = 1, 3 \op 3 = 3, 3 \op 4 = 0$$
which violates all three equations at $x=0$.

\subsection{Equation 713}

Similar arguments can actually handle 713: $x = y \op (y \op ((y \op x) \op x))$. Here, the laws defining a partial solution are
\begin{itemize}
\item (Law 1) If $(y \op x) \op x$ is defined, then $y \op (y \op ((y \op x) \op x))$ is defined and equal to $x$.
\item (Law 2) $x \op y \neq y$ for all $x,y$.
\item (Law 3) If $Sx$ is defined, then so is $Sx \op x$.
\end{itemize}

\begin{lemma}[713 extension]\label{713-extension}\leanok\lean{Eq1722.Greedy.lift}  Suppose that $\op$ is a partial solution, and $a \op b$ is currently undefined.  Then there exists an extension $\op'$ of $\op$ for which $a \op' b$ is defined.
\end{lemma}

\begin{proof}  First suppose that $a \op a$ is not defined.  Set $a_0 := a$ and select three new elements $a_1,a_2,a_3$.  Define $a_0 \op a_0 = a_1$, $a_1 \op a_0 = a_2$, $a_0 \op a_2 = a_3$, $a_0 \op a_1 = a_3$, $a_0 \op a_3 = a_0$.  It is a routine but tedious matter to check that Laws 1,2,3 are preserved by these operations.  (The trickiest case is the $x=a_0$ case of Law 1; here we need Law 2 to prevent $y \op a_0$ from equalling $a_0$.)

Now suppose that $a \op b$ is undefined for some $a \neq b$.  Let $d_1,d_2,\dots,d_n$ be all the elements with $d_i \op b = a$.  Note from Law 3 that none of the $d_i$ can be equal to $b$.  Choose a new element $c$, as well as $c_i$ for each $d_i$, and set $a \op b = c$, $d_i \op c = c_i$, and $d_i \op c_i = b$.  It is easy to see that this preserves Laws 2,3.  For Law 1 ,we do the usual case analysis:
\begin{itemize}
\item Case 1: $y = c$, $y = c_i$, $y \op x = c$, or $y \op x = c_i$.  This case cannot occur because we have not defined left multiplication with $c$ or $c_i$.
\item Case 2: $x = c$ or $x = c_i$.  Because $d_i \neq b$, it is easy to see that $(y \op x) \op x$ is not defined for any $x$.
\item Case 3: $(y \op x) \op x = c$ or $(y \op x) \op x = c_i$.  This is only possible if $x=b$ and $y = d_j$ for some $j$, and the claim then follows from construction.
\item Case 4: None of the terms in $(y \op x) \op x$ are equal to $c$ or $c_i$.  This follows from the previous seed.
\end{itemize}
\end{proof}

One can now refute the implications of the equations $x = x \op ((x \op x) \op (x \op x))$ (817), $x = (x \op x) \op (x \op (x \op x))$ (1426), $x \op x = (x \op (x \op x)) \op x$ (3862), $x \op x = ((x \op x) \op x) \op x$ (4065) by using the partial solution
$$ 0 \op 0 = 1, 0 \op 1 = 3, 0 \op 2 = 3, 0 \op 3 = 0$$
$$1\op 0 = 2, 1 \op 1 = 0, 1 \op 2 = 1, 1 \op 3 =2 , 1 \op 4 = 3$$
$$ 2 \op 0 = 2, 2 \op 2 = 4, 2 \op 4 = 0$$
$$ 4 \op 1 = 2, 4 \op 2 = 4, 4 \op 3 = 2, 4 \op 4 = 1.$$
which violates 3862 at $x=2$ and the other three laws at $x=0.$

\subsection{Equation 1289}

For $x = y \op (((x \op y) \op y) \op y)$ (1289), one can similarly argue using the rules
\begin{itemize}
\item (Law 1) If $((x \op y) \op y) \op y$ is already defined, then $y \op (((x \op y) \op y) \op y)$ is also defined and equals $x$.
\item (Law 2) $R_x$ is injective for all $x$ currently in the table.
\item (Law 3) $x\op x=x$ for all $x$ currently in the table.
\end{itemize}

\begin{lemma}[1289 extension]\label{1289-extension}\leanok\lean{Eq1289.Greedy.lift}  Suppose that $\op$ is a partial solution, and $a \op b$ is currently undefined.  Then there exists an extension $\op'$ of $\op$ for which $a \op' b$ is defined.
\end{lemma}

\begin{proof}
If $a \op b$ is currently undefined, introduce a new element $c$ and define $a \op b = c$ and $ c \op c = c.$ If furthermore $a = (d \op b) \op b$ for some d, then also define $b \op c = d$ (This last step is well defined by injectivity of $R_b$).

We now check that the three axioms still hold. Law 3 is obvious, law 2 follows since $d \not = c$. For law 1, we first make the observation that $a \not = b$, for otherwise $a \op b$ would have been defined. This has the consequence that if $d$ exists, then $d \not = b$, for otherwise $a = (b \op b) \op b = b.$ In particular, the product $d \op c$ remains undefined after running the algorithm once.

We now work by cases on the values of the variables $x,y$ appearing in law 1:
\begin{itemize}
\item Case 1: $y=c$. In this case, for the product $x \op y$ to be defined, we require $x =b$ or $x = c$. In the former case either $b \op c$ or $(b \op c) \op c = d \op c$ is not defined. In the latter case, law 1 holds as $c$ is idempotent.
\item Case 2: $y=b$. For $((x \op b) \op b) \op b$ to be defined now but not have been defined before, we require one of $x= a, (x \op b) = a, ((x \op b) \op b) = a.$ The first two cases are eliminated as $c \op b$ is not yet defined. The last case holds as then $d$ exists and equals $x$, so $b \op (((x \op b) \op b) \op b) = b \op (a \op b) = b \op c = x.$
\item Case 3: $y \not = c, y \not = b$. We have introduced no new products with a right-hand side other than $c$ or $b$, so if $((x \op y) \op y) \op y$ was undefined before it remains undefined now.
\end{itemize}
\end{proof}

To refute $x \op (y \op x) = (x \op y) \op x$ (4435) and $x = (((y \op x) \op y) \op y) \op y$ (3316) we use the partial solution
$$ 0 \op 0 = 0; 0 \op 1 = 2; 0 \op 2 = 1; 0 \op 4 = 1$$
$$ 1 \op 0 = 2; 1 \op 1 = 1$$
$$ 2 \op 0 = 3; 2 \op 2 = 2$$
$$ 3 \op 0 = 4; 3 \op 3 = 3$$
$$ 4 \op 4 = 4$$
which violates 4435 at $(x,y)=(0,1)$ and 3116 at $(x,y)=(2,0).$

\subsection{Equation 73}

For $x = y \op (y \op (x \op y))$ (73), we argue similarly, now with laws
\begin{itemize}
\item Law 1.  If $y \op (x \op y)$ is defined, then $y \op (y \op (x \op y))$ is defined and equal to $x$.
\item Law 2.  $R_y$ is injective for all $y$ currently in the table.
\item Law 3.  $x \op y \neq y$ for all $x,y$ currently in the table.
\end{itemize}

\begin{lemma}[73 extension]\label{73-extension}  Suppose that $\op$ is a partial solution, and $a \op b$ is currently undefined.  Then there exists an extension $\op'$ of $\op$ for which $a \op' b$ is defined.
\end{lemma}

\begin{proof} If $a \op b$ is undefined, set it equal to a new element $c$.  If we also have $b = d \op a$ for some $d$ (unique by Law 2, and only possible for $a \neq b$ by Law 3), set $a \op c = d$.

It is obvious that Laws 2, 3 are preserved.   Now we case check Law 1:
\begin{itemize}
\item Case 1: $x=c$ or $y=c$.  Not possible since no left multiplication with $c$ is defined.
\item Case 2: $x \op y = c$.  Only possible when $x = a$, $y = b$, but then $y \op (x \op y)$ is undefined since $y = b \neq a$ if $d$ is defined.
\item Case 3. $y \op (x \op y) = c$.  Only possible when $y=a$ and $x=d$, and holds in this case.
\item Case 4: $x, y, x \op y, y \op (x \op y) \neq c$: this case is already covered by the previous seed.
\end{itemize}
\end{proof}

One can obtain various refutations by using the countermodels \href{https://leanprover.zulipchat.com/#narrow/channel/458659-Equational/topic/713.2C.201289.2C.201447/near/483735768}{here}.

\subsection{Equation 63}


For $x = y \op (x \op (x \op y))$ (63), we argue similarly, now with laws
\begin{itemize}
  \item Law 1.  If $x \diamond (x \diamond y)$ is defined, then $y \diamond (x \diamond (x \diamond y))$ is defined and equal to $x$.
  \item Law 2.  If $x \diamond y = x \diamond z$ with $y,z$ distinct, then $y \diamond x$ (if defined) is not equal to $z$ or to $z \diamond x$ (if defined).
  \item Law 3: If $x \diamond x$ is defined, it is equal to $x$.
  \item Law 4: If $x \neq y$, then $x \diamond y$ is not equal to $x$.
\end{itemize}
\begin{lemma}[63 extension]\label{63-extension}  Suppose that $\op$ is a partial solution, and $a \op b$ is currently undefined.  Then there exists an extension $\op'$ of $\op$ for which $a \op' b$ is defined.
\end{lemma}
\begin{proof}


If $a = b$, set $a \diamond' a = a$.  This clearly does not destroy Laws 3 or 4, and because of Law 4, Law 2 will also be retained.
Finally, using Law 4, we can check that this addition does not break Law 1.

Now suppose $a \neq b$.
Let $d_1,d_2,..., d_n$ be all the elements with $b = a \diamond d_i$, and note from Law 3 and $a \neq b $ that we have the crucial inequality $d_i \neq a$ for all $i$.  If $d_i \diamond a$ is defined, let $e_i = d_i \diamond a.$ From Law 4 and $d_i \neq a$, we have $e_i \neq d_i$. From Law 2 and $a \diamond d_i = a \diamond d_j$, we further have $e_i \neq e_j$ and $e_i \neq d_j$ for $i \neq j$.

 For the algorithm, we set $a \diamond' b = c$ for some new $c$, $d_i \diamond' c = a$, and $c \diamond' e_i = d_i$ (This is well defined as we have just argued $e_i \neq e_j$ for $i \neq j$).

This creates a new partial function.  Law 2 is verified as follows:
The case $x=c$ cannot occur because $c \diamond' e_i \neq c \diamond' e_j$ for $i \neq j$.
If $y=c$, then $x = d_i$ for some $i$, but then $y \diamond' x = c \diamond' d_i$ is undefined as $d_i \neq e_j$, so this case is vacuous.
If $z=c$ and $x,y \neq c$, then similarly $z \diamond' x$ is undefined, and $y \diamond' x$ is not equal to
$c = z$, so we are ok in this case also.

Law 3 is clearly unaffected, and it is also straightforward to check that Law 4 is also not invalidated
(here it is essential that $d_i \neq a$).

Now we verify Law 1.
\begin{itemize}
  \item Case 1: $x=c$.  Then for $x \diamond' y$ to be defined we must have $y=e_i$ for some $i$, but then
$x \diamond' (x \diamond' y) = c \op' d_i$ is undefined as $d_i \neq e_j$ for all $j$.
\item Case 2: $y=c$. Then for $x \diamond' y$ to be defined we must have $x = d_i$ for some $i$. Then $d_i \op' (d_i \op' c)$ is either undefined or is equal to $e_i$, in which case Law 1 holds as $c \op' e_i = d_i$.
\item Case 3: $x \diamond' y = c$.  Then $x=a$ and $y=b$.  Since $d_i \neq a$ for all $i$, $x \diamond (x \diamond y)$ is undefined.
\item Case 4: $x \op' (x \op' y) = c$. Then $x = a$ and $y = d_i$ for some $i$, and Law 1 holds as $d_i \op' c = a$.
\item Case 5: None of $x, y, x \diamond' y, x \op' (x \op' y)$ are equal to $c$.  Then this case is covered by the previous seed.
\end{itemize}
\end{proof}
One can obtain various refutations by using the countermodels \href{https://leanprover.zulipchat.com/#narrow/channel/458659-Equational/topic/713.2C.201289.2C.201447/near/483735768}{here}.

\subsection{Equation 1076}
For $x = y \op ((x \op (x \op y)) \op y)$ (1076), we argue similarly. There are just two laws:
\begin{itemize}
    \item Law 1.  If $x \diamond (x \diamond y)$ is defined and equal to some $z$,
then $y \diamond (z \diamond y)$ is defined and equal to $x$.
    \item Law 2.  $x \diamond x$ is not equal to $x$.
\end{itemize}

\begin{lemma}[1076 extension]\label{1076-extension}\leanok\lean{Eq1076.Greedy.lift}  Suppose that $\op$ is a partial solution, and $a \op b$ is currently undefined.  Then there exists an extension $\op'$ of $\op$ for which $a \op' b$ is defined.
\end{lemma}
\begin{proof}
Set $a \diamond' b = c$ for some new element $c$. If $d_1,d_2,...,d_n$ are the elements for which $a \diamond d_i = b$, set $c \diamond' d_i = c'_i$ for some new element $c'_i$, and also set
$d_i \diamond' c'_i = a$. If $d_i \diamond a$ is equal to some $e_i$, set $e_i \diamond' c'_i = c''_i$ and $c'_i \diamond' c''_i = d_i$,
where $c''_i$ is equal to $a$ if $e_i = d_i$, or is some new element otherwise.

One can verify that no collisions are caused by this construction (this is why we have to take $c''_i=a$ when $e_i=d_i$),
 and that Law 2 is preserved.

We need to verify that these constructions preserve Law 1.  There are several cases:
\begin{itemize}

  \item $y=c$.  Not possible since there are no right multiplications by $c$ defined.
  \item $x=c$.  Not possible since it forces $y = d_i$, $x \diamond y = c'_i$ for some $i$.
  \item $y=c'_i$, $x = d_i$.  True by construction.
  \item $y=c'_i$, $x \neq d_i$.  This forces $x = e_i \neq d_i$ and $x \diamond' y = c''_i$, but then $x \diamond' (x \diamond' y)$ is undefined.
  \item $x=c'_i$.  Not possible because this forces $x \diamond' y = d_i$, and $x \diamond' (x \diamond' y)$ will be undefined.
 (Here we use the fact that $e_i=d_i$ can only occur when $d_i \neq a$, by Law 2.)
 \item  $x = c''_i$ is new.  Not possible as no left multiplications by $c''_i$ are defined.
 \item $y=c''_i$ is new.  This forces $x = c'_i$ and $x \diamond' y = d_i$, but then $x \diamond' (x \diamond' y)$ is undefined.
 \item $x$ and $y$ are not new and $x \diamond y$ was undefined. This requires $x=a, y=b$, but then $x \diamond' (x \diamond' y)$
is undefined since right multiplication by $c$ is undefined.
\item $x$, $y$ are not new and $x \diamond y$ was defined, but $x \diamond (x \diamond y)$ was undefined.
This requires $x=a$, $x \diamond y = b$, and hence $y = d_i$ for some $i$.  The claim now follows from construction.
\item  $x$, $y$, are not new and $x \diamond y$, $x \diamond (x \diamond y)$ were defined. This then follows from the previous seed.
\end{itemize}
\end{proof}

One can obtain various refutations by using the countermodels \href{https://leanprover.zulipchat.com/#narrow/channel/458659-Equational/topic/713.2C.201289.2C.201447/near/483735768}{here}.
\subsection{Equation 3308}

Similar: see \href{https://leanprover.zulipchat.com/#narrow/channel/458659-Equational/topic/713.2C.201289.2C.201447/near/482066500}{here} and \href{https://leanprover.zulipchat.com/#narrow/channel/458659-Equational/topic/713.2C.201289.2C.201447/near/483735768}{here}.


\section{A survey of examples}\label{infinite-examples-section}

\subsection{Translation-invariant models}

The implication between the laws \Cref{eq1648} and \Cref{eq206} can be refuted by a translation-invariant
magma on the integers. Define the function $f: \mathbb{Z} \to \mathbb{Z}$ by
$$f(x) =
\begin{cases}
  -1  & \text{if } x > 0, \\
   0  & \text{if } x = 0, \\
   1  & \text{if } x < 0,
\end{cases}$$
and consider the translation-invariant magma on $\mathbb{Z}$ given by the operation $x \op y = x + f(y-x)$.

The resulting magma satisfies Equation 1648: one can show this by a case analysis on $f(y-x)$. If $f(y-x)=1$ we have $x \op y = x + f(y-x) = x + 1$, so
$$(x \op y) \op ((x \op y) \op y) = (x + 1) \op ((x + 1) \op y) = (x + 1) \op (x + 2) = (x + 1) - 1 = x.$$
Similar computations verify the other two cases.

However, setting $x=0$ and $y=-1$ in Equation 206, we get
$$(x \op (x \op y)) \op y = (x \op 1) \op y = (-1) \op y = -1 \neq x$$
so the magma does not obey \Cref{eq206}. We can conclude

\begin{theorem}[1648 does not imply 206]\label{non_imp_1648_206_thm}\uses{eq1648,eq206,models-def}
  \lean{Equation1648_not_implies_Equation206}\leanok
  There exists a magma which satisfies \Cref{eq1648} and not \Cref{eq206}.
\end{theorem}

There are variation of the translation-invariant constructions refuting implications: e.g. in some cases,
similar constructions are carried out starting with a non-Abelian group. Translation-invariant models
are also useful building blocks for the \emph{modified base model} constructions explained below.

\subsection{Modified base models}

For some pairs of laws $P$ and $Q$, it is possible to start with an infinite model $(M,\op)$ obeying both $P$ and $Q$,
then modify the operation $\op$ in a limited way, resulting in a model $(M,\op')$ of $P$ that does not obey $Q$.

This works especially well when this \emph{base model} $(M,\op)$ is a translation-invariant magma in which
the function $f$ takes finitely many different values. This is common: e.g. the translation-invariant model
refuting the implication above is of the required sort!

The strategy is to first modify the magma operation in a naive way, by introducing a counterexample to the
consequent $Q$. This generally yields one or more counterexamples to the antecedent $P$, but one can
\emph{trace} the effects of this initial modification and make further adjustments which restore the
antecedent.

A model refuting the implication between the laws \Cref{eq1659} and \Cref{eq4315} can be constructed using
the modified base model technique. Start with the infinite model $(\mathbb{Z},\op)$ of \Cref{eq1659} given by the following operation:
$$ x\op y = \begin{cases} x+1 & \text{if } x,y \text{ have the same parity} \\ x -1 & \text{otherwise} \end{cases} $$
A case analysis shows that the magma $(\mathbb{Z},\op)$  satisfies both \Cref{eq1659} and \Cref{eq4315}.
We will eventually \emph{modify} it by setting
$$x \op' y = \begin{cases} 0 & \text{if } x=0,\: x,y \text{ do not have the same parity} \\  x+1 & \text{if } x,y \text{ have the same parity} \\ x -1 & \text{otherwise} \end{cases}$$
and checking that $(\mathbb{N}, \op' )$ satisfies \Cref{eq1659} but refutes \Cref{eq4315}.

One finds these modifications using the following strategy:

First, choose some element (tuple) of the carrier $M$ that will constitute a counterexample to the
consequent in the modified model. In this specific case, the consequent, \Cref{eq4315}, can be written as
$$ x \op (y \op x) = x \op (y \op z)$$
in equational form, which always holds when $x = z$. So let's choose the tuple $(0,0,1)$
to constitute the required counterexample. Computing $0 \op (0 \op 0) = 0 \op 1 = -1$ and similarly
$0 \op (0 \op 1) = -1$ suggest that we could force this tuple to be a counterexample by defining a new
operation $\op''$ and setting
$0 \op'' 1$ to something other than $-1$. One seemingly has many choices here: should we take
$0 \op'' 1 =0$, $0 \op'' 1 = 1$, $0 \op'' 1 = 2$, or perhaps even $0 \op'' 1 = -1$?

It's easy to rule out some of the possibilities. For instance, setting $0 \op'' 1 = 1$ would
yield $0 \op'' (0 \op'' 0) = 0 \op'' 1 = 0 \op'' (0 \op'' 1)$ again. The simplest possibility which results in
a counterexample to \Cref{eq4315} sets $0 \op'' 1 = 0$ and $x \op'' y = x \op y$ for any $x \neq 0, y \neq 1$.

Unfortunately, the resulting $(M,\op'')$ would not then obey \Cref{eq1659}. For any $z \in M$, one would have
$$ (0 \op'' 1) \op'' ((1 \op'' 1) \op'' z) = 0 \op'' (2 \op'' z)$$
which equals $0 \op'' 1 = 0$ as desired for even $z$, but equals $0 \op'' 3 = -1 \neq 0$ for odd $z$.

However, since $f$ takes finitely many values in the base model, the breakage is tightly controlled:
by considering what happens if $x \neq 0$ and $y \neq 1$, we see that all new counterexamples to \Cref{eq4315}
have this form. The calculation now suggests defining yet another $\op'''$, where setting
$0 \op''' 3 = 0$ would eliminate
this counterexample. But doing that just moves the issue one level higher: one then has
$$ (0 \op''' 3) \op''' ((3 \op''' 3) \op''' z) = 0 \op''' (4 \op''' z)$$ which equals $0 \op''' 3 = 0$ as desired for even $z$, but equals $0 \op''' 5 = -1 \neq 0$ for odd $z$.

Instead, the infinitely many counterexamples arising from the iterated redefinition can be eliminated
all at once by setting:

$$x \op' y = \begin{cases} 0 & \text{if } x=0,\: x,y \text{ do not have the same parity} \\  x+1 & \text{if } x,y \text{ have the same parity} \\ x -1 & \text{otherwise} \end{cases}$$

At this point one might as well truncate the model to $\mathbb{N}$ since the result of the $\op'$
operation is nonnegative whenever the operands are nonnegative. This finishes the construction and proves

\begin{theorem}[1659 does not imply 4315]\label{non_imp_1659_4315_thm}\uses{eq1659,eq4315,models-def}
  \lean{Equation1659_facts}\leanok
  There exists a magma which satisfies \Cref{eq1659} and not \Cref{eq4315}.
\end{theorem}

The result of a modified base model construction can be a finite modification (when $\op$ and $\op'$
differ in finitely many inputs) or one in which they differ in infinitely many coefficients. Note that if the base
model $(M,\op)$ was obtained by a greedy construction, and $(M,\op')$ is a finite modification, then the
modified model could also have been obtained using the same greedy construction. It is not surprising that
more difficult refutations using this construction tend to require the latter sort of modification.


\section{The Dupont equation}\label{dupont-section}

Now we consider the Dupont equation, \Cref{eq63}, which can be treated by a greedy translation invariant construction that is more complicated than the one considered for the Asterix law in \Cref{asterix-section}.

If we adopt a translation-invariant model
$$ x \op y = x + f(y-x)$$
on some abelian group $G$, then with $y = x+h$, we have
$$ x \op y = x + f(h)$$
$$ x \op (x \op y) = x + f^2(h)$$
$$ y \op (x \op (x \op y)) = y + f(f^2(h)-h)$$
and so the Dupont law $x = y \op (x \op (x \op y))$ becomes the functional equation
\begin{equation}\label{dupont-eq}
  f(f^2(h)-h) = -h.
\end{equation}
One way to solve this equation is to have an automorphism $T: G \to G$ that obeys the identity
$$ T^3 - T = -I,$$
then one can just take $f(h) = T(h)$.  For instance, if $G = \Z^3$, one can take the automorphism $T: \Z^3 \to \Z^3$ defined by
$$ T(x,y,z) := (-z,x+z,y).$$

We now extend this greedily to $\Z^3 \times \Z$ as follows.  Define a \emph{partial solution} $(E_1,E_2,f)$ to be a pair $\Z^3 \subset E_1 \subset E_2 \subset \Z^3 \times \Z$, and a function $f: E_2 \to E_1$ obeying the following axioms.
\begin{description}
  \item[(a)] The set $E_2 \backslash \Z^3$ is finite.
  \item[(b)] For $h \in \Z^3$, $f(h) = Th$; in particular, $f$ is a bijection on $\Z^3$.
  \item[(c)] For $h \in E_1 \backslash \Z^3$, $f(h) \in E_1$.  Also, $-h + f^2(h) \in E_1$ and $f(-h + f^2(h)) = -h$. Note that this (and (b)) implies that $-h \in E_1$, thus $E_1$ is symmetric around the origin.
  \item[(d)] For $h \in E_2 \backslash E_1$, $f(h) \in E_1$.
  \item[(e)] The elements $-h$, $h - f^2(h)$, and $f^2(h) - h$ for $h \in E_2 \backslash E_1$ are all distinct from each other, and all lie outside of $E_2$.  In particular this forces $f^2(h) \neq 0$, hence $f(h) \neq 0$. It also forces $f^2(h) \neq h$, hence $f(h) \neq h$.
\end{description}
Thus for instance one can take $(\Z^3,\Z^3,T)$ as a partial solution.  We say that a partial solution $(E'_1, E'_2, f')$ is an \emph{extension} of $(E_1,E_2,f)$ if $E_1 \subset E'_1$, $E'_2 \subset E_2$, and $f'$ agrees with $f$ on $E_2$.

Informally, $E_1$ represents the portion of $\Z^3 \times \Z$ where we have completely resolved the Dupont equation; the set $E_2 \backslash E_1$ represents the portion for which $f$ (and all forward iterates of $f$) have been defined, but the Dupont equation has not yet been verified; and the elements $-h$, $h - f^2(h)$, and $f^2(h) - h$ for $h \in E_2 \backslash E_1$ are the portion where $f$ is not yet defined, but for which one is ready to ``promote'' these elements to $E_2$ or $E_1$ by defining $f$ appropriately.

The key lemmas are then

\begin{lemma}[Promoting to $E_1$]\label{add-E1}  If $(E_1,E_2,f)$ is a partial solution and $h \in E_2 \backslash E_1$, then there exists an extension $(E'_1,E'_2,f')$ of $(E_1,E_2,f)$ such that $h \in E'_1$.
\end{lemma}

\begin{proof} This will be a greedy construction, but we have to introduce a rather large number of additional elements to ensure that certain non-degeneracy conditions are maintained (in particular, the new elements $h'$ introduced have to be such that $f^2(h') - h'$ avoids $E_2$ and hence $\Z^3$, which requires a certain amount of complexity in the construction).

  Let $\tilde E_2$ denote the set $E_2$ together with all the elements of the form $-h'$, $h' - f^2(h')$, and $f^2(h') - h'$ for $h' \in E_2 \backslash E_1$; this is $\Z^3$ with a finite number of additional elements.

Let $a$ be an element of $\Z^3$ such that the quantities
$$ \pm Ta, \pm(Ta + a)$$
are distinct from each other and from
$$0, \pm h, \pm (h - f(h)), \pm (f^2(h)-h);$$
this is possible since $T, T+1$ are invertible.

Next, we pick an $x \in \Z^3 \times \Z$ such that the quantities
$$ \pm x, \pm x + Ta, \pm x - Ta, \pm 2 x + Ta, \pm x + Ta + a, \pm (h + x), \pm (h - f(h) + x), \pm (f^2(h)-h + x + Ta)$$
are all distinct from each other and from $\tilde E_2$; indeed, from the choice of $a$ (and the non-zero nature of $h$, $f(h)$, $h-f(h)$, and $f^2(h)-h$) there are only finitely many $x$ for which a collision can occur between any pair of these expressions.

We now promote $\pm h, \pm x, \pm x + Ta, \pm x - Ta$ to $E_1$, and also promote $h+x$, $h - f^2(h)$, $\pm 2x + Ta$, $\pm x + Ta + a$ to $E_2$.  That is to say, we define
$$ E'_1 := E_1 \cup \{\pm h, \pm x, \pm x + Ta, \pm x - Ta\}$$
and
$$ E'_2 := E_2 \cup \{ -h, \pm x, \pm x + Ta, \pm x - Ta, h + x, h - f^2(h), \pm 2x + Ta \}.$$
We then define an extension $f'$ of $f$ to $E'_2$ by setting
\begin{align*}
 f'(\pm x) &:= a \\
 f'(\pm x + Ta) &:= \pm x \\
 f'(\pm x - Ta) &:= \mp x + Ta \\
 f'(\pm x + Ta + a) &:= \pm x - Ta \\
 f'(\pm 2x + Ta) &:= \pm x + Ta \\
 f'(\pm x + Ta + a) &:= \pm x - Ta \\
 f'(-h) &:= x + Ta \\
 f'(h+x) &:= h \\
 f'(h - f^2(h)) &:= -h.
\end{align*}
It is easy to see that $(E'_1,E'_2,f')$ obeys properties (a), (b), (d).  By construction, we have
$$ f'( (f')^2(h') - h') = -h'$$
for
$$ h' = \pm h, \pm x, \pm x+Ta, \pm x-Ta$$
giving property (c).  By construction, the quantities
$$ -h', h' - f^2(h'), f^2(h') - h'$$
are distinct from each other and lie outside of $\tilde E_2 \cup E'_2$ for
$$ h' = h+x, h - f^2(h), \pm 2x + Ta, \pm x + Ta + a$$
while these quantities are distinct from each other and lie in $\tilde E_2 \backslash E'_2$ for $h' \in E_2 \backslash E'_1$ (note that this forces $h' \neq \pm h$).  This gives property (e).
\end{proof}


\begin{lemma}[Promoting to $E_2$]\label{add-E2}  If $(E_1,E_2,f)$ is a partial solution and $h \in (\Z^3 \times \Z) \backslash E_2$, then there exists an extension $(E'_1,E'_2,f')$ of $(E_1,E_2,f)$ such that $h \in E'_2$.
\end{lemma}

\begin{proof}  Let $\tilde E_2$ denote the set $E_2$ together with all elements of the form
\begin{equation}\label{hp-form}
 -h', h' - f^2(h'), f^2(h') - h'
\end{equation}
for some $h' \in E_2 \backslash E_1$; this is $\Z^3$ with a finite number of elements attached, and is symmetric around the origin.

First suppose that $h$ lies outside of $\tilde E_2$.  Then we can find $a \in \Z^3$ such that the quantities
$$ -h, \pm (h - Ta)$$
are distinct from each other, and lie outside of $\tilde E_2$.  We now promote $h$ to $E_2$, thus setting
$$ E'_1 := E_1$$
and
$$ E'_2 := E_2 \cup \{h\}$$
and define an extension $f'$ of $f$ to $E'_2$ by setting
$$ f'(h) := a.$$
It is then a routine matter to check that $(E'_1,E'_2,f')$ is an extension of $(E_1,E_2,f)$.

Now suppose that $h$ lies in $\tilde E_2$.  Then $h$ is of one of the forms \Cref{hp-form} for some $h' \in E_2 \backslash E_1$.  Suppose it is of the form $-h'$ or $f^2(h') - h'$.  We invoke \Cref{add-E1} to promote $h'$ to $E_1$ by using a suitable extension $(E'_1,E'_2,f')$; and now $h$ will lie in $E'_2$, giving the claim.  If instead $h$ is of the form $h'-f^2(h')$, then this procedure might not place $h$ in $E'_2$; but if it does not, it will be of the form $-h''$ for $h'' = f^2(h')-h' \in E'_2 \backslash E'_1$.  Applying \Cref{add-E1} one more time to now promote $h''$ to $E_1$, we will obtain a larger extension $(E''_1,E''_2,f'')$ with $h \in E''_2$, giving the claim.
\end{proof}

Iterating these lemmas in the usual fashion, we can conclude that any partial solution can be completed to a global model of \Cref{eq63}.

Among other things, this permits one to generate models in which the function $f$ is not injective.  To see this, let $a$ be a non-zero element of $\Z^3$, let $x$ be an element of $\Z^3 \times \Z$ outside of $\Z^3$, and consider the partial solution $(\Z^3, \Z^3 \cup \{x\}, f)$ where $f(h) = Th$ for $h \in \Z^3$ and $f(x) = a$.  One can check that this is a partial solution and is not injective, since $f(x) = f(T^{-1} a)$.  This non-injectivity implies in particular that the model is not left-cancellative, and hence does not obey the law
$$ x = (y \op x) \op ((y \op x) \op y)$$
(equation 1692).

\subsection{Second construction}

We now give a second construction, with works on the integers $G = \Z$.

We first define a seed solution $f_0: E_0 \to \Z$ defined on the set $E_0 := \{-7, -3, -2, -1, 0, 1, 3, 4, 6 \}$ with
$$ f(-7)=-4, f(-3) = 4, f(-2)=-3, f(-1)=-1, f(0) = 1, f(1) = 3, f(3)=0, f(4) = -2, f(6) = 2.$$

In this construction, we define a partial solution to be a function $f: E \to \Z$ defined on a finite subset of $E$ obeying the following axioms:
\begin{itemize}
\item[(i)] $E$ contains $E_0$, and $f$ agrees with $f_0$ on $E_0$.
\item[(ii)] If $h \in E$ and $f(h) \in E$, then $f^2(h)-h$ is also in $E$, and $f(f^2(h)-h) = -h$.
\item[(iii)] If $h \in E$ and $h \neq 3$, then $f(h) \neq 0$.
\item[(iv)]  If $a \neq a'$ are distinct elements of $E$ with $f(a)=f(a')$, and $-a \in E$, then $a' \neq a + f(-a)$.
\item[(v)]  If $a \neq a'$ are distinct elements of $E$ with $f(a)=f(a')$, and $-a, -a' \in E$, then $a' + f(-a') \neq a + f(-a)$.
\end{itemize}
We say that a partial solution $f': E' \to \Z$ \emph{extends} another $f: E \to \Z$ if $E'$ contains $E$ and $f'$ agrees with $f$ on $E$.

\begin{lemma}[Seed solution]\label{finite-check} $f_0: E_0 \to \Z$ is a partial solution.
\end{lemma}

\begin{proof} Finite check.
\end{proof}

\begin{lemma}[Extension]\label{extension-lemma} If $f: E \to \Z$ is a partial solution and $h_0 \in \Z$, then there exists an extension $f': E' \to \Z$ for which axiom (ii) applies, i.e., $h_0 \in E'$, $f'(h_0) \in E'$, $(f')^2(h_0)-h_0 \in E'$, and $f'((f')^2(h_0)-h_0) = -h_0$.
\end{lemma}

\begin{proof}  We divide into cases.

  {\bf Case 1:} $h_0 \in E$ and $f(h_0) \in E$.  In this case we are already done thanks to axiom (ii).

  {\bf Case 2:} $h_0 \in E$ but $f(h_0) \not \in E$.  This is the main case.  Let $H$ be the set of all $h \in E$ such that $f(h) = f(h_0)$; this is a finite set containing $h_0$.  Let $H' \subset H$ be the set of all $h' \in H$ such that $-h' \in E$.  We make the following observations:
  \begin{itemize}
  \item[(a)] All elements $h$ of $H$ are non-zero.  For if $h=0$ then $f(h_0)=f(h)=1 \in E$, contradicting the hypothesis $f(h_0) \not \in E$.
  \item[(b)]  If $h' \in H'$ then $h' \neq h'+f(-h')$.  Otherwise we would have $f(-h')=0$, then by axiom (iii) we have $h' = -3$, hence $f(h_0) = f(h') = 4 \in E$ by axiom (i).  But this again contradicts the hypothesis $f(h_0) \not \in E$. (This is the main reason we take $E_0$ to be so large.)
  \item[(c)]  If $h_1 \in H$ and $h_2 \in H'$ are distinct then $h_1 \neq h_2+f(-h_2)$.  This follows from axiom (iv).
  \item[(d)]  If $h_1, h_2\in H'$ are distinct then $h_1+f(-h_1) \neq h_2+f(-h_2)$. This follows from axiom (v).
  \end{itemize}

  From these observations, we see that if we take $c$ to be a sufficiently large integer, the following claims hold:
  \begin{itemize}
  \item[1.]  The expressions $\pm c$, $\pm(c - h)$ for $h \in H$, and $\pm(c-h'-f(-h'))$ for $h \in H'$ are all distinct from each other.
  \item[2.]  $c$ is not expressible as the sum of four or fewer elements of $\pm (E \cup f(E))$.
  \end{itemize}

  We select such a $c$.  We then promote $f(h_0)$, $c - h$ for $h \in H$, and $-c+h'+f(-h')$ for $h' \in H'$, thus setting
  $$ E' := E \cup \{f(h_0)\} \cup \{ c-h: h \in H\} \cup \{ -c+h'+f(-h'): h' \in H'\}.$$
We then extend $f$ to $f': E' \to \Z$ by setting
\begin{align*}
  f(f(h_0)) &:= c \\
  f(c-h) &:= -h \\
  f(-c+h'+f(-h')) &:= h' - c
\end{align*}
for all $h \in H$ and $h' \in H'$.  Axiom (i) is then obvious.  Axiom (ii) needs to be verified for the new elements $h_0$ and $c-h'$, $h' \in H'$ of $E'$ (the other elements will not obey the hypotheses of this axiom), but this is routine.  In particular $h_0$ obeys the required conclusion of this lemma.

We need to verify (iii) for the new elements of $E'$, but this is clear from property (a) and claim 2.

Now we need to verify (iv).  It suffices to do so when at least one of $a,a',-a$ are new elements of $E'$.  If neither of $a$, $-a$ are new, then the only new elements $a'$ for which $f(a')$ could equal $f(a)$ take the form $c-h$ (thanks to claim 2), but then $a'$ cannot equal $a+f(-a)$, again thanks to claim 2.  If instead one of $a, -a$ is new, then from claim 1 the new element must be $f(h_0)$.  There is no old element $a'$ with $f(a') = c = f(f(h_0))$, so we must have $a = -f(h_0)$, but then $a + f(-a) = -f(h_0)+c$ will not equal $a'$, again thanks to claim 2.

Finally, we need verify to (v).  We may assume that at least one of $a,a',-a,-a'$ are new elements of $E'$.  As before, this forces the new element to be $f(h_0)$, and this cannot be $a$ or $a'$, so without loss of generality we have $a = -f(h_0)$ and $a' \in E$.  But then $a + f(-a) = -f(h_0)+c$ will not equal $a' + f(-a')$, again thanks to claim 2.

{\bf Case 3:} $h_0 \not \in E$ but $h_0 \in f(E)$.  Here we can write $h_0 = f(h_1)$ where $h_1$ is of the form in Case 2.  Applying the Case 2 construction, we can pass to an extension in which $f(h_1) = h_0$ lies in $E$, and so we are now in either Case 1 or Case 2, and so we can again conclude.

{\bf Case 4:} $h_0 \not \in E$ and $h_0 \not \in f(E)$.  We let $c$ be an integer so large that it is not expressible as the sum of four or fewer elements of $\pm (E \cup f(E))$.  We then promote $h_0$ to $E$ by setting
$$E' := E \cup \{h_0\}$$
and define an extension $f': E' \to \Z$ by setting $f'(h_0) := c$.  Axioms (i)-(iii) are obvious.  For axiom (iv), since $f'(h_0)$ is not equal to any other value of $f'$, the only new case introduced is if $-a = h_0$, but then $a+f(-a) = -h_0+c$ is distinct from $a'$ by choice of $c$.  A similar argument yields axiom (v).  With this extension, we are now in Case 2, and so we repeat the previous analysis to conclude.
\end{proof}

Iterating this lemma, we conclude

\begin{corollary}[Greedy completion of Dupont]\label{dupont-iter} Every partial solution $f: E \to \Z$ can be extended to a global solution $f': \Z \to\Z$ of \Cref{dupont-eq}.
\end{corollary}

\begin{corollary}[Non-injective Dupont solution]\label{non-inject} The Dupont equation admits non-injective solutions, and hence can violate Equation 1692.
\end{corollary}

\begin{proof} It suffices to find a partial solution that violates injectivity.  This can be done for instance by adjoining $\{-13, 10\}$ to $E_0$ and defining $f(10)= 2 = f(6)$, $f(-13)=-10$, and performing a finite check to verify that this is still a partial solution.
\end{proof}

\section{An ad hoc model}\label{adhoc-model}

\begin{theorem}  There exists a magma which satisfies Equation 3342,
$$ x \op y = y \op (x \op (x \op x)),$$
but such that none of the laws
\begin{align*}
  x \op x &= x \op ((x \op x) \op x) \\
  x \op y &= x \op ((y \op y) \op y) \\
  x \op x &= ((x \op x) \op x) \op x \\
  x \op y &= ((x \op x) \op x) \op y.
\end{align*}
hold.
\end{theorem}

\begin{proof}
We begin with some informal motivation. Writing
\begin{equation}\label{fdef}
  f(x) := x \op (x \op x),
\end{equation}
we conclude that
\begin{equation}\label{xop}
   x \op y = y \op f(x)
\end{equation}
and hence on iteration
$$ x \op y = f(x) \op f(y).$$
In particular, $x \op x = f(x) \op f(x)$, and
$$ f(x) = x \op (x \op x) = (x \op x) \op f(x) = (f(x) \op f(x)) \op f(x).$$
If $f$ is surjective, this would imply
$$ x = (x \op x) \op x$$
and hence the four laws stated above would hold in this case.

This motivates the use of a non-surjective $f$.  We will take $G$ to be the space of polynomials $\Z[t]$ of one variable with integer coefficients, and let $f: G \to G$ be the multiplication by $t$ map:
$$ f(P) := tP.$$
This is of course non-surjective. The magma operation will be constructed as follows:
\begin{itemize}
  \item If $P$ is a polynomial with $P(0) \neq 0$, then $t^n P \op t^n P = t^n P \op t^{n+1} P = 2P$ for all $n \geq 0$, and $t^{n+m} P \op 2t^n P = 2t^n P \op t^{n+m+1} P = t^{m+1} P$ for all $n, m \geq 0$.  (This is well-defined since the $t^n P$, $2t^n P$ are all distinct polynomials.)
  \item We define $P \op Q = 0$ if not covered by the above laws.
\end{itemize}

It is a routine matter to verify \Cref{fdef} and \Cref{xop}, so that equation 3342 holds.  However, one can check that the four laws in the conclusion fail with $x=y=1$.
\end{proof}

%\begin{theorem}[3475 construction]\label{3475-construct}
%There exists a magma that obeys equation 3475,
%$$ x \op x = y \op ((x \op y) \op y),$$
%but does not obey equation 3659,
%$$x \op x = (x \op x) \op (x \op x)$$
%\end{theorem}
%
%\begin{proof} We will give a construction where $x \op x$ takes on only two values (and depends on the ``sign'' of $x$), while $x \op y$ depends primarily on $y$ and the sign of $x$.
%
%We can rewrite 3475 as
%$$ x^2 = L_y R_y^2 x$$
%where $x^2 = x \op x$, $L_y x = y \op x$, and $R_y x = x \op y$. Similarly, 3659 can be rewritten as $x^2 \op x^2 = x^2$.
%
%For our model, we take $G$ to be the non-zero integers $\Z^\times$.  The operation $R_y x = x \op y$ is defined to equal
%\begin{itemize}
%\item $2y$ if $x$ has the opposite sign to $y$,
%\item $\mathrm{sgn}(x)$ if $y = 3x$,
%\item $-\mathrm{sgn}(x)$ if $y = x, 2x, 5x$,
%\item $3y$ if $x=2y$,
%\item $5y$ otherwise.
%\end{itemize}
%One can then see that $x^2$ is equal to $-\mathrm{sgn}(x)$ %for all $x$.  In particular,
%$$ x^2 \op x^2 = -\mathrm{sgn}(x^2) = \mathrm{sgn}(x) \neq %- \mathrm{sgn}(x) = x^2$$
%so that equation 3659, $x^2 = x^2 \op x^2$, fails.

%Now we verify 3475.  A routine case check shows that when $x$ has the opposite sign to $y$, $R_y^2 x = 3y$; and when $x$ has the same sign to $y$, $R_y^2 x$ is equal to $2y$ or $5y$.  But then $L_y R_y^2 x$ is equal to $\mathrm{sgn}(y)$ if $x$ has the opposite sign to $y$, and $-\mathrm{sgn}(y)$ if $x$ has the same sign to $y$, giving 3475.
%\end{proof}


\begin{theorem}[1437 example]\label{1437-thm}  There exists a magma that obeys Equation 1437,
  $$ x = (x \op x) \op (y \op (z \op x)),$$
but does not obey equation 4269,
$$ x \op (x \op x) = x \op (y \op x).$$
\end{theorem}

\begin{proof} A first attempt would be the operation $i \op j := j+1$ on $\Z/3\Z$; this obeys 1437, but unfortunately also obeys 4269.  However, an "extension" of this operation will work. Namely, we take the carrier $G = \N \times \Z/3\Z$ and define $(a,i) \op (b,j)$ to equal
  \begin{itemize}
    \item $(a-1,j+1)$ if $i=j+2$ and $a>0$;
    \item $(b,j+1)$ if $i=j+2$ and $a=0$;
    \item $(a+1,j+1)$ otherwise.
  \end{itemize}
Note that $(a,i) \op (a,i) = (a+1,i+1)$, and that $(b,j) \op ((c,k) \op (a,i))$ will be of the form $(d,i+2)$ for some $d$.  Hence
$$ ((a,i) \op (a,i)) \op ((b,j) \op ((c,k) \op (a,i))) = (a+1-1, i+3) = (a,i),$$
giving 1437.  On the other hand,
$$ (0,i) \op ((b,i) \op (0,i)) = (0,i) \op (b+1,i+1) = (b+1,i+2)$$
and so equation 4269 fails.
\end{proof}
