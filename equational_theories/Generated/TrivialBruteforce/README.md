This directory contains a simple bruteforce script with several theorems for several trivial 'proof scripts'. The results have been minimized by only including implications necessary for the transitive reduction of all bruteforce-generated theorems.

Sep 28: The transitive closure (e.g. total number of derived implications) of the theorems proven by {Apply.lean, RewriteGoal.lean, RewriteHypothesis.lean, RewriteHypothesisAndGoal.lean} is 4,299,405.
Oct 1: Another ~250k transitive implications were generated by {RewriteCombinations.lean, NthRewrites.lean}.

The following are directions to reproduce the theorems in this directory:
1) Generate refutations

I generate refuted implications to cut down on the amount of proving work. This takes data from Nicholas Carlini, and generates a CSV of not-implication pairs that our bruteforce does not have to check

```sh
python generate_refutations.py > REFUTATION_PAIRS.csv
```

2) Generate lean files to bruteforce

Modify the code in bruteforce.rb to generate theorems in whatever form you'd like to test. Some examples:

```
   repeat intro
   apply h
```
```
   repeat intro
   repeat rw [h]
```
```
   repeat intro
   try { rw [<-h] }
   try { rw [<-h, <-h] }
   try { rw [<-h, <-h, <-h] }
   try { rw [<-h, <-h, <-h, <-h] }
   try { rw [<-h, <-h, <-h, <-h, <-h] }
   repeat rw [h]
```

Note that the in the last example it was necessary to use `try` instead of `repeat rw [<-h]` due to long loops.

NthRewrite/RewriteCombinations were generated using `bruteforce_nth_rewrites.rb`/`bruteforce_rewritecombinations.rb`. 

Then generate one file per equation using:

```sh
ruby bruteforce.rb Apply
```

This generates a `Makefile.Apply` file and a `BruteforceApply` directory.

3) Run lean on generated files and collect errors

Move the `Makefile.Apply` to the root directory and `BruteforceApply` to `/equational_theories`. Then run the bruteforce:

```sh
make -f Makefile.Apply -j6
```

Note that you can insert the number of cores you'd like to parallelize across in the -j parameter above.

If this runs very rapidly, it's possible that your files are not being run correctly and that your output is corrupted. Check that the `BruteforceApply/Output` has files full of errors like:

```
equational_theories/BruteforceApply/bf_17.lean:4:2: error: tactic 'apply' failed, failed to unify
  ?x = ?y ∘ (?y ∘ ?y)
with
  x✝ = y✝
G : Type u_1
inst✝ : Magma G
h : Equation17 G
x✝ y✝ : G
⊢ x✝ = y✝
```

4) Find theorems that succeeded

Note that if your files failed to run and generate errors as mentioned above, this step will generate bad data.

Now to find what theorems succeeded, you can run:

```sh
ruby print_successful_theorems.rb BruteforceApply
```

You can run the following to print out successful pairs of implications in CSV format instead:
```sh
ruby print_successful_theorems.rb BruteforceApply | ruby -ne 'puts "#{$1},#{$2}" if $_ =~ /Equation(\d+)_implies_Equation(\d+)/'
```

5) Find the transitive reduction of implications

Given the CSV from above, you can calculate the transitive reduction (e.g. minimal set of implications necessary to print the entire set) using:

```sh
ruby scripts/transitive_reduction.rb Apply.csv
```

Using this output, it is now possible to re-generate the minimal set of theorems.

6) Bonus: Reduce try {}s

I make heavy use of try in some places, to reduce dead code in the final output, you can add `import Mathlib.Tactic` to a file (to import linters). Then run the following to generate linter warnings and filter those lines out:

```sh
lake env lean RewriteCombinations.lean &> /tmp/lean.out
cat /tmp/lean.out |& grep "warning:" | egrep -e "(tactic does nothing|this tactic is never executed)" | cut -d ':' -f 2 | sort -nu > /tmp/useless_lines
ruby try_less.rb RewriteCombinations.lean /tmp/useless_lines | ruby -e 'puts $stdin.read.gsub!("  try {\n  }\n", "")' > New.lean
mv New.lean RewriteCombinations.lean
```
